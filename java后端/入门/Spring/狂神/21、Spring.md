# Spring:hatching_chick::hatching_chick::hatching_chick:

::: tip ğŸ£ğŸ£ğŸ£

- **å“‡ä½ å¥½å‰å®³ï¼å­¦åˆ°æ¡†æ¶å•¦ï¼**<br><br>
  æœ¬èŠ‚ä¸»è¦è®²äº†æ—©æœŸæˆ‘ä»¬å¼€å‘webé¡µé¢ä½¿ç”¨çš„Springæ¡†æ¶ <br>
  æˆ‘ä»¬çš„webé¡¹ç›®çš„æ¼”å˜æ˜¯è¿™æ ·çš„ï¼š<br>
  <h3>javaWeb-><em style="color: red;">spring</em>->springMVC->springBoot->springCloud...</h3><br>
  å…¶å®åˆ°è¿™é‡Œï¼Œå¦‚æœæƒ³ç›´æ¥ä¸Šæ‰‹å¼€å‘çš„è¯ç›´æ¥çœ‹springBootå°±è¡Œ<br>
  å­¦ä¹ äº†Springæˆ‘ä»¬å°±çŸ¥é“æœ€æ—©å¼€å‘webçš„åŸå§‹çŠ¶æ€ï¼Œä¹Ÿå¸®åŠ©æˆ‘ä»¬å¾ªåºæ¸è¿›å»å­¦ä¹ æ–°çš„ä¸œè¥¿ï¼<br>
  æˆ‘ä¹‹æ‰€ä»¥å­¦è¿™èŠ‚æ˜¯å› ä¸ºæˆ‘é‚£æ—¶æ‰å¤§äºŒï¼Œæœ‰å¤§æŠŠæ—¶é—´å»ä»å­¦ä¹ åŸºç¡€ï¼
  ä¸è¿‡è¿™èŠ‚çœŸçš„ç®€åŒ–äº†å¾ˆå¤šServletçš„ä¸œè¥¿ï¼Œä¸è¿‡é…ç½®ä¹Ÿæ˜¯ç›¸å½“ç¹çå‘€ï¼
  <br/><br/>
- **çœ‹å®Œæœ¬èŠ‚å¯ä»¥åˆ©ç”¨æ¡†æ¶å¼€å‘ä¸€ä¸ªç®€å•çš„webé¡¹ç›®å’¯ï¼<br/>** <br/>
- **æˆ‘ä»¬é€šå¸¸æŠŠSpringç§°ä¸º"é…ç½®åœ°ç‹±"å“ˆå“ˆå“ˆå“ˆï¼å­¦å®Œä½ å°±çŸ¥é“å•¦**
- **<p style="color:red">åŠ æ²¹~</p>**
  :::

# 1ã€Springæ¦‚è¿°

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350692.jpg)

# spring

# 1.1ç®€ä»‹

- Springï¼šæ˜¥å¤©-->ç»™è½¯ä»¶è¡Œä¸šå¸¦æ¥äº†æ˜¥å¤©
- 2002å¹´ï¼ŒRod Johnsoné¦–æ¬¡æ¨å‡ºäº†Springæ¡†æ¶é›å½¢interface21æ¡†æ¶ã€‚
- 2004å¹´3æœˆ24æ—¥ï¼ŒSpringæ¡†æ¶ä»¥interface21æ¡†æ¶ä¸ºåŸºç¡€ï¼Œç»è¿‡é‡æ–°è®¾è®¡ï¼Œå‘å¸ƒäº†1.0æ­£å¼ç‰ˆã€‚
- å¾ˆéš¾æƒ³è±¡Rod Johnsonçš„å­¦å†ï¼Œä»–æ˜¯æ‚‰å°¼å¤§å­¦çš„åšå£«ï¼Œç„¶è€Œä»–çš„ä¸“ä¸šä¸æ˜¯è®¡ç®—æœºï¼Œè€Œæ˜¯éŸ³ä¹å­¦ã€‚
- Springç†å¿µï¼šä½¿ç°æœ‰æŠ€æœ¯æ›´åŠ å®ç”¨ã€‚æœ¬èº«å°±æ˜¯ä¸€ä¸ªå¤§æ‚çƒ©ï¼Œæ•´åˆç°æœ‰çš„æ¡†æ¶æŠ€æœ¯

å®˜ç½‘ï¼šhttp://spring.io/

å®˜æ–¹ä¸‹è½½åœ°å€ï¼šhttps://repo.spring.io/libs-release-local/org/springframework/spring/

GitHub: https://github.com/spring:projects

# 1.2 ä¼˜ç‚¹

- Springæ˜¯ä¸€ä¸ªå¼€æºå…è´¹çš„æ¡†æ¶ï¼Œå®¹å™¨ã€‚
- Springæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ¡†æ¶ï¼Œéä¾µå…¥å¼çš„ã€‚
- æ§åˆ¶åè½¬ IoCï¼Œé¢å‘åˆ‡é¢ Aop
- å¯¹äº‹ç‰©çš„æ”¯æŒï¼Œå¯¹æ¡†æ¶çš„æ”¯æŒ

ä¸€å¥è¯æ¦‚æ‹¬ï¼šSpringæ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ§åˆ¶åè½¬(IoC)å’Œé¢å‘åˆ‡é¢(AOP)çš„å®¹å™¨ï¼ˆæ¡†æ¶ï¼‰ã€‚

# 1.3 ç»„æˆ

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350693.jpg)

Spring æ¡†æ¶æ˜¯ä¸€ä¸ªåˆ†å±‚æ¶æ„ï¼Œç”± 7 ä¸ªå®šä¹‰è‰¯å¥½çš„æ¨¡å—ç»„æˆã€‚Spring æ¨¡å—æ„å»ºåœ¨æ ¸å¿ƒå®¹å™¨ä¹‹ä¸Šï¼Œæ ¸å¿ƒå®¹å™¨å®šä¹‰äº†åˆ›å»ºã€é…ç½®å’Œç®¡ç† bean
çš„æ–¹å¼ã€‚

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350694.jpg)

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350695.jpg)

ç»„æˆ Spring æ¡†æ¶çš„æ¯ä¸ªæ¨¡å—ï¼ˆæˆ–ç»„ä»¶ï¼‰éƒ½å¯ä»¥å•ç‹¬å­˜åœ¨ï¼Œæˆ–è€…ä¸å…¶ä»–ä¸€ä¸ªæˆ–å¤šä¸ªæ¨¡å—è”åˆå®ç°ã€‚æ¯ä¸ªæ¨¡å—çš„åŠŸèƒ½å¦‚ä¸‹ï¼š

- æ ¸å¿ƒå®¹å™¨ï¼šæ ¸å¿ƒå®¹å™¨æä¾› Spring æ¡†æ¶çš„åŸºæœ¬åŠŸèƒ½ã€‚æ ¸å¿ƒå®¹å™¨çš„ä¸»è¦ç»„ä»¶æ˜¯ BeanFactoryï¼Œå®ƒæ˜¯å·¥å‚æ¨¡å¼çš„å®ç°ã€‚BeanFactory
  ä½¿ç”¨æ§åˆ¶/åè½¬ (IOC) æ¨¡å¼å°†åº”ç”¨ç¨‹åºçš„é…ç½®å’Œä¾èµ–æ€§è§„èŒƒä¸å®é™…çš„åº”ç”¨ç¨‹åºä»£ç åˆ†å¼€ã€‚
- Springä¸Šä¸‹æ–‡ï¼šSpringä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå‘Springæ¡†æ¶æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚Springä¸Šä¸‹æ–‡åŒ…æ‹¬ä¼ä¸šæœåŠ¡ï¼Œä¾‹å¦‚JNDIã€EJBã€ç”µå­é‚®ä»¶ã€å›½é™…åŒ–ã€æ ¡éªŒå’Œè°ƒåº¦åŠŸèƒ½ã€‚
- Spring AOPï¼šé€šè¿‡é…ç½®ç®¡ç†ç‰¹æ€§ï¼ŒSpring AOP æ¨¡å—ç›´æ¥å°†é¢å‘åˆ‡é¢çš„ç¼–ç¨‹åŠŸèƒ½ï¼Œé›†æˆåˆ°äº† Spring æ¡†æ¶ä¸­ã€‚æ‰€ä»¥ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ Spring
  æ¡†æ¶ç®¡ç†ä»»ä½•æ”¯æŒ AOP çš„å¯¹è±¡ã€‚Spring AOP æ¨¡å—ä¸ºåŸºäº Spring çš„åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡æä¾›äº†äº‹åŠ¡ç®¡ç†æœåŠ¡ã€‚é€šè¿‡ä½¿ç”¨ Spring
  AOPï¼Œä¸ç”¨ä¾èµ–ç»„ä»¶ï¼Œå°±å¯ä»¥å°†å£°æ˜æ€§äº‹åŠ¡ç®¡ç†é›†æˆåˆ°åº”ç”¨ç¨‹åºä¸­ã€‚

- Spring DAO: JDBC DAO æŠ½è±¡å±‚æä¾›äº†æœ‰æ„ä¹‰çš„å¼‚å¸¸å±‚æ¬¡ç»“æ„ï¼Œå¯ç”¨è¯¥ç»“æ„æ¥ç®¡ç†å¼‚å¸¸å¤„ç†å’Œä¸åŒæ•°æ®åº“ä¾›åº”å•†æŠ›å‡ºçš„é”™è¯¯æ¶ˆæ¯ã€‚å¼‚å¸¸å±‚æ¬¡ç»“æ„ç®€åŒ–äº†é”™è¯¯å¤„ç†ï¼Œå¹¶ä¸”æå¤§åœ°é™ä½äº†éœ€è¦ç¼–å†™çš„å¼‚å¸¸ä»£ç æ•°é‡ï¼ˆä¾‹å¦‚æ‰“å¼€å’Œå…³é—­è¿æ¥ï¼‰ã€‚Spring
  DAO çš„é¢å‘ JDBC çš„å¼‚å¸¸éµä»é€šç”¨çš„ DAO å¼‚å¸¸å±‚æ¬¡ç»“æ„ã€‚
- Spring ORM: Spring æ¡†æ¶æ’å…¥äº†è‹¥å¹²ä¸ª ORM æ¡†æ¶ï¼Œä»è€Œæä¾›äº† ORM çš„å¯¹è±¡å…³ç³»å·¥å…·ï¼Œå…¶ä¸­åŒ…æ‹¬ JDOã€Hibernate å’Œ iBatis SQL
  Mapã€‚æ‰€æœ‰è¿™äº›éƒ½éµä» Spring çš„é€šç”¨äº‹åŠ¡å’Œ DAO å¼‚å¸¸å±‚æ¬¡ç»“æ„ã€‚
- Spring Web æ¨¡å—ï¼šWeb ä¸Šä¸‹æ–‡æ¨¡å—å»ºç«‹åœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡æ¨¡å—ä¹‹ä¸Šï¼Œä¸ºåŸºäº Web çš„åº”ç”¨ç¨‹åºæä¾›äº†ä¸Šä¸‹æ–‡ã€‚æ‰€ä»¥ï¼ŒSpring æ¡†æ¶æ”¯æŒä¸
  Jakarta Struts çš„é›†æˆã€‚Web æ¨¡å—è¿˜ç®€åŒ–äº†å¤„ç†å¤šéƒ¨åˆ†è¯·æ±‚ä»¥åŠå°†è¯·æ±‚å‚æ•°ç»‘å®šåˆ°åŸŸå¯¹è±¡çš„å·¥ä½œã€‚
- Spring MVC æ¡†æ¶ï¼šMVC æ¡†æ¶æ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„æ„å»º Web åº”ç”¨ç¨‹åºçš„ MVC å®ç°ã€‚é€šè¿‡ç­–ç•¥æ¥å£ï¼ŒMVC æ¡†æ¶å˜æˆä¸ºé«˜åº¦å¯é…ç½®çš„ï¼ŒMVC
  å®¹çº³äº†å¤§é‡è§†å›¾æŠ€æœ¯ï¼Œå…¶ä¸­åŒ…æ‹¬ JSPã€Velocityã€Tilesã€iText å’Œ POIã€‚

# 1.4 æ‹“å±•

# Spring Bootä¸Spring Cloud

- Spring Boot æ˜¯ Spring çš„ä¸€å¥—å¿«é€Ÿé…ç½®è„šæ‰‹æ¶ï¼Œå¯ä»¥åŸºäºSpring Boot å¿«é€Ÿå¼€å‘å•ä¸ªå¾®æœåŠ¡ï¼›
- Spring Cloudæ˜¯åŸºäºSpring Bootå®ç°çš„ï¼›
- Spring Bootä¸“æ³¨äºå¿«é€Ÿã€æ–¹ä¾¿é›†æˆçš„å•ä¸ªå¾®æœåŠ¡ä¸ªä½“ï¼ŒSpring Cloudå…³æ³¨å…¨å±€çš„æœåŠ¡æ²»ç†æ¡†æ¶ï¼›
- Spring Bootä½¿ç”¨äº†çº¦æŸä¼˜äºé…ç½®çš„ç†å¿µï¼Œå¾ˆå¤šé›†æˆæ–¹æ¡ˆå·²ç»å¸®ä½ é€‰æ‹©å¥½äº†ï¼Œèƒ½ä¸é…ç½®å°±ä¸é…ç½®ï¼ŒSpring Cloudå¾ˆå¤§çš„ä¸€éƒ¨åˆ†æ˜¯åŸºäºSpring
  Bootæ¥å®ç°ï¼ŒSpring Bootå¯ä»¥ç¦»å¼€Spring Cloudç‹¬ç«‹ä½¿ç”¨å¼€å‘é¡¹ç›®ï¼Œä½†æ˜¯Spring Cloudç¦»ä¸å¼€Spring Bootï¼Œå±äºä¾èµ–çš„å…³ç³»ã€‚
- SpringBootåœ¨SpringCloundä¸­èµ·åˆ°äº†æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼Œå¦‚æœä½ è¦å­¦ä¹ SpringCloudå¿…é¡»è¦å­¦ä¹ SpringBootã€‚

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350696.jpg)

# 2ã€IoCåŸºç¡€

æ–°å»ºä¸€ä¸ªç©ºç™½çš„mavené¡¹ç›®

# 2.1 åˆ†æå®ç°

æˆ‘ä»¬å…ˆç”¨æˆ‘ä»¬åŸæ¥çš„æ–¹å¼å†™ä¸€æ®µä»£ç ã€‚

1. å…ˆå†™ä¸€ä¸ªUserDaoæ¥å£

```txt
public interface UserDao { public void getUser(); }
```

2. å†å»å†™Daoçš„å®ç°ç±»

```java
public class UserDaoImpl implements UserDao {
    @Override
    public void getUser() {
        System.out.println("è·å–ç”¨æˆ·æ•°æ®");
    }
}
```

3. ç„¶åå»å†™UserServiceçš„æ¥å£

```java
public interface UserService { public void getUser(); }
```

4. æœ€åå†™Serviceçš„å®ç°ç±»

```java
public class UserServiceImpl implements UserService { private Dao userDao  $=$  new DaoImpl(); @Override public void getUser() { userDao.getUser(); }   
8
```

5. æµ‹è¯•ä¸€ä¸‹

```java
1 @Test   
2 public void test(){   
3äººæ°‘æœåŠ¡ service  $=$  newäººæ°‘æœåŠ¡Impl();   
4 service.getUser();   
5 }
```

è¿™æ˜¯æˆ‘ä»¬åŸæ¥çš„æ–¹å¼ï¼Œå¼€å§‹å¤§å®¶ä¹Ÿéƒ½æ˜¯è¿™ä¹ˆå»å†™çš„å¯¹å§ã€‚é‚£æˆ‘ä»¬ç°åœ¨ä¿®æ”¹ä¸€ä¸‹ã€‚

æŠŠUserdaoçš„å®ç°ç±»å¢åŠ ä¸€ä¸ª.

```java
public class UserDaoMySQLImpl implements DAO {
    @Override
    public void getUser() {
        System.out.println("MySQLè·å–ç”¨æˆ·æ•°æ®");
    }
}
```

ç´§æ¥ç€æˆ‘ä»¬è¦å»ä½¿ç”¨MySQLçš„è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦å»serviceå®ç°ç±»é‡Œé¢ä¿®æ”¹å¯¹åº”çš„å®ç°ã€‚

```java
public class UserServiceImpl implementsUserService {
    private UserDao userDao = new UserDaoMySQLImpl();
    @Override
    public void getUser() {
        userDao.getUser();
    }
}
```

åœ¨å‡è®¾ï¼Œæˆ‘ä»¬å†å¢åŠ ä¸€ä¸ªUserdaoçš„å®ç°ç±»ã€‚

```java
1 public class UserDaoOracleImpl implements UserDao {
2     @Override
3     public void getUser() {
4         System.out.println("Oracleè·å–ç”¨æˆ·æ•°æ®");
5         }
6     }
```

é‚£ä¹ˆæˆ‘ä»¬è¦ä½¿ç”¨Oracleï¼Œåˆéœ€è¦å»serviceå®ç°ç±»é‡Œé¢ä¿®æ”¹å¯¹åº”çš„å®ç°ã€‚å‡è®¾æˆ‘ä»¬çš„è¿™ç§éœ€æ±‚éå¸¸å¤§ï¼Œè¿™ç§æ–¹å¼å°±æ ¹æœ¬ä¸é€‚ç”¨äº†ï¼Œç”šè‡³åäººç±»å¯¹å§ï¼Œæ¯æ¬¡å˜åŠ¨ï¼Œéƒ½éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç ã€‚è¿™ç§è®¾è®¡çš„è€¦åˆæ€§å¤ªé«˜äº†ï¼Œç‰µä¸€å‘è€ŒåŠ¨å…¨èº«ã€‚

# é‚£æˆ‘ä»¬å¦‚ä½•å»è§£å†³å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥åœ¨éœ€è¦ç”¨åˆ°ä»–çš„åœ°æ–¹ï¼Œä¸å»å®ç°å®ƒï¼Œè€Œæ˜¯ç•™å‡ºä¸€ä¸ªæ¥å£ï¼Œåˆ©ç”¨setï¼Œæˆ‘ä»¬å»ä»£ç é‡Œä¿®æ”¹ä¸‹ã€‚

```java
1 public class UserServiceImpl implements Service {
2     private DAO userDao;
3         // åˆ©ç”¨setå®ç°
4         public void setDAO(UserDao userDao) {
55         this.userDao = userDao;
6         }
7
8         @Override
9         public void getUser() {
10         userDao.getUser();
11         }
12 }
```

ç°åœ¨å»æˆ‘ä»¬çš„æµ‹è¯•ç±»é‡Œï¼Œè¿›è¡Œæµ‹è¯•ï¼›

```java
1 @Test   
2 public void test(){   
3 ç”¨æˆ·ServiceImpl service  $=$  new UserServiceImpl();   
4 service.setUserDao(new UserDaoMySQLImpl());   
5 service.getUser();   
6 //é‚£æˆ‘ä»¬ç°åœ¨åˆæƒ³ç”¨Oracleå»å®ç°å‘¢   
7 service.setUserDao(new UserDaoOracleImpl());   
8 service.getUser();   
9 }
```

å¤§å®¶å‘ç°äº†åŒºåˆ«æ²¡æœ‰ï¼Ÿå¯èƒ½å¾ˆå¤šäººè¯´æ²¡å•¥åŒºåˆ«ã€‚ä½†æ˜¯åŒå­¦ä»¬ï¼Œä»–ä»¬å·²ç»å‘ç”Ÿäº†æ ¹æœ¬æ€§çš„å˜åŒ–ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½ä¸ä¸€æ ·äº†ã€‚ä»”ç»†å»æ€è€ƒä¸€ä¸‹ï¼Œä»¥å‰æ‰€æœ‰ä¸œè¥¿éƒ½æ˜¯ç”±ç¨‹åºå»è¿›è¡Œæ§åˆ¶åˆ›å»ºï¼Œè€Œç°åœ¨æ˜¯ç”±æˆ‘ä»¬è‡ªè¡Œæ§åˆ¶åˆ›å»ºå¯¹è±¡ï¼ŒæŠŠä¸»åŠ¨æƒäº¤ç»™äº†è°ƒç”¨è€…ã€‚ç¨‹åºä¸ç”¨å»ç®¡æ€ä¹ˆåˆ›å»ºï¼Œæ€ä¹ˆå®ç°äº†ã€‚å®ƒåªè´Ÿè´£æä¾›ä¸€ä¸ªæ¥å£ã€‚

è¿™ç§æ€æƒ³ï¼Œä»æœ¬è´¨ä¸Šè§£å†³äº†é—®é¢˜ï¼Œæˆ‘ä»¬ç¨‹åºå‘˜ä¸å†å»ç®¡ç†å¯¹è±¡çš„åˆ›å»ºäº†ï¼Œæ›´å¤šçš„å»å…³æ³¨ä¸šåŠ¡çš„å®ç°ã€‚è€¦åˆæ€§å¤§å¤§é™ä½ã€‚è¿™ä¹Ÿå°±æ˜¯IOCçš„åŸå‹ï¼

# 2.2 IOCæœ¬è´¨

æ§åˆ¶åè½¬IoC(Inversion of Control)ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼ŒDI(ä¾èµ–æ³¨å…¥)
æ˜¯å®ç°IoCçš„ä¸€ç§æ–¹æ³•ï¼Œä¹Ÿæœ‰äººè®¤ä¸ºDIåªæ˜¯IoCçš„å¦ä¸€ç§è¯´æ³•ã€‚æ²¡æœ‰IoCçš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œå¯¹è±¡çš„åˆ›å»ºä¸å¯¹è±¡é—´çš„ä¾èµ–å…³ç³»å®Œå…¨ç¡¬ç¼–ç åœ¨ç¨‹åºä¸­ï¼Œå¯¹è±¡çš„åˆ›å»ºç”±ç¨‹åºè‡ªå·±æ§åˆ¶ï¼Œæ§åˆ¶åè½¬åå°†å¯¹è±¡çš„åˆ›å»ºè½¬ç§»ç»™ç¬¬ä¸‰æ–¹ï¼Œä¸ªäººè®¤ä¸ºæ‰€è°“æ§åˆ¶åè½¬å°±æ˜¯ï¼šè·å¾—ä¾èµ–å¯¹è±¡çš„æ–¹å¼åè½¬äº†ã€‚

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350697.jpg)

- å›¾1ï¼šè€¦åˆçš„å¯¹è±¡

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350698.jpg)  
å›¾2ï¼šè§£è€¦çš„è¿‡ç¨‹

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350699.jpg)  
å›¾3ï¼šç†æƒ³çš„ç³»ç»Ÿ

loCæ˜¯Springæ¡†æ¶çš„æ ¸å¿ƒå†…å®¹ï¼Œä½¿ç”¨å¤šç§æ–¹å¼å®Œç¾çš„å®ç°äº†IoCï¼Œå¯ä»¥ä½¿ç”¨XMLé…ç½®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£ï¼Œæ–°ç‰ˆæœ¬çš„Springä¹Ÿå¯ä»¥é›¶é…ç½®å®ç°IoCã€‚

Springå®¹å™¨åœ¨åˆå§‹åŒ–æ—¶å…ˆè¯»å–é…ç½®æ–‡ä»¶ï¼Œæ ¹æ®é…ç½®æ–‡ä»¶æˆ–å…ƒæ•°æ®åˆ›å»ºä¸ç»„ç»‡å¯¹è±¡å­˜å…¥å®¹å™¨ä¸­ï¼Œç¨‹åºä½¿ç”¨æ—¶å†ä»locå®¹å™¨ä¸­å–å‡ºéœ€è¦çš„å¯¹è±¡ã€‚

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350700.jpg)

é‡‡ç”¨XMLæ–¹å¼é…ç½®Beançš„æ—¶å€™ï¼ŒBeançš„å®šä¹‰ä¿¡æ¯æ˜¯å’Œå®ç°åˆ†ç¦»çš„ï¼Œè€Œé‡‡ç”¨æ³¨è§£çš„æ–¹å¼å¯ä»¥æŠŠä¸¤è€…åˆä¸ºä¸€ä½“ï¼ŒBeançš„å®šä¹‰ä¿¡æ¯ç›´æ¥ä»¥æ³¨è§£çš„å½¢å¼å®šä¹‰åœ¨å®ç°ç±»ä¸­ï¼Œä»è€Œè¾¾åˆ°äº†é›¶é…ç½®çš„ç›®çš„ã€‚

æ§åˆ¶åè½¬æ˜¯ä¸€ç§é€šè¿‡æè¿°ï¼ˆXMLæˆ–æ³¨è§£ï¼‰å¹¶é€šè¿‡ç¬¬ä¸‰æ–¹å»ç”Ÿäº§æˆ–è·å–ç‰¹å®šå¯¹è±¡çš„æ–¹å¼ã€‚åœ¨Springä¸­å®ç°æ§åˆ¶åè½¬çš„æ˜¯IoCå®¹å™¨ï¼Œå…¶å®ç°æ–¹æ³•æ˜¯ä¾èµ–æ³¨å…¥ï¼ˆDependency
Injection,DIï¼‰ã€‚

# 3ã€HelloSpring

# 3.1ã€å¯¼å…¥JaråŒ…

æ³¨ï¼šspring éœ€è¦å¯¼å…¥commons-loggingè¿›è¡Œæ—¥å¿—è®°å½•ã€‚æˆ‘ä»¬åˆ©ç”¨mavenï¼Œä»–ä¼šè‡ªåŠ¨ä¸‹è½½å¯¹åº”çš„ä¾èµ–é¡¹ã€‚

```xml
1 <dependency>
2 <groupId>org.springframework</groupId>
3 <artifactId>spring-web MVC</artifactId>
4 <version>5.1.10.RELEASE</version>
5 </dependency>
```

# 3.2ã€ç¼–å†™ä»£ç 

# 1. ç¼–å†™ä¸€ä¸ªHelloå®ä½“ç±»

```java
1 public class Hello {
2     private String name;
3         public String getName() {
45         return name;
6         }
7     public void setName(String name) {
8         this.name = name;
9         }
10         public void show(){
12         System.out.println("Hello," + name);
13         }
14 }
```

# 2. ç¼–å†™æˆ‘ä»¬çš„springæ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å‘½åä¸ºbeans.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schemabeans">
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi: schemaLocation="http://www.springframework.org/schemabeans(http://www.springframework.org/schemabeans spring-beans.xsd)"
</beanå°±æ˜¯javaå¯¹è±¡ï¼Œç”±Springåˆ›å»ºå’Œç®¡ç†-->
<bean class="com.kuang.pojo.Hello">
    <property name="name" value="Spring"/>
</bean>
```

# 3. æˆ‘ä»¬å¯ä»¥å»è¿›è¡Œæµ‹è¯•äº†ã€‚

```txt
1 @Test   
2 public void test(){   
3 //è§£æbeans.xmlæ–‡ä»¶ï¼Œç”Ÿæˆç®¡ç†ç›¸åº”çš„Beanå¯¹è±¡   
4 ApplicationContext context  $=$  new   
5 ClassPathXmlApplicationContext("beans.xml");   
6 //getBeanï¼šå‚æ•°å³ä¸ºspringé…ç½®æ–‡ä»¶ä¸­beançš„id.   
7 Hello hello  $=$  (Helloï¼‰context.getBean("hello");   
8 hello.show();   
}
```

# 3.3ã€æ€è€ƒ

- Hello å¯¹è±¡æ˜¯è°åˆ›å»ºçš„ï¼Ÿã€hello å¯¹è±¡æ˜¯ç”±Springåˆ›å»ºçš„ã€‘

- Hello å¯¹è±¡çš„å±æ€§æ˜¯æ€ä¹ˆè®¾ç½®çš„?ã€hello å¯¹è±¡çš„å±æ€§æ˜¯ç”±Springå®¹å™¨è®¾ç½®çš„ã€‘

è¿™ä¸ªè¿‡ç¨‹å°±å«æ§åˆ¶åè½¬ï¼š

- æ§åˆ¶ï¼šè°æ¥æ§åˆ¶å¯¹è±¡çš„åˆ›å»ºï¼Œä¼ ç»Ÿåº”ç”¨ç¨‹åºçš„å¯¹è±¡æ˜¯ç”±ç¨‹åºæœ¬èº«æ§åˆ¶åˆ›å»ºçš„ï¼Œä½¿ç”¨Springåï¼Œå¯¹è±¡æ˜¯ç”±Springæ¥åˆ›å»ºçš„
- åè½¬ï¼šç¨‹åºæœ¬èº«ä¸åˆ›å»ºå¯¹è±¡ï¼Œè€Œå˜æˆè¢«åŠ¨çš„æ¥æ”¶å¯¹è±¡ã€‚

ä¾èµ–æ³¨å…¥ï¼šå°±æ˜¯åˆ©ç”¨setæ–¹æ³•æ¥è¿›è¡Œæ³¨å…¥çš„ã€‚

IOCæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³ï¼Œç”±ä¸»åŠ¨çš„ç¼–ç¨‹å˜æˆè¢«åŠ¨çš„æ¥æ”¶

å¯ä»¥é€šè¿‡newClassPathXmlApplicationContextå»æµè§ˆä¸€ä¸‹åº•å±‚æºç ã€‚

# 3.4ã€ä¿®æ”¹æ¡ˆä¾‹ä¸€

æˆ‘ä»¬åœ¨æ¡ˆä¾‹ä¸€ä¸­ï¼Œæ–°å¢ä¸€ä¸ªSpringé…ç½®æ–‡ä»¶beans.xml

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schemabeans">
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi: schemaLocation="http://www.springframework.org/schemabeans
            http://www.springframework.org/schemabeans/spring-beans.xsd">
    <bean id="MysqIImpl" class="com.kuang.dao.impl.UserDaoMySqlImpl"/>
    <bean id="OracleImpl" class="com.kuang.dao.impl.UserDaoOracleImpl"/>
    <bean id="ServiceImpl" class="com.kuang.service.impl.UserServiceImpl">
        <!--æ³¨æ„ï¼šè¿™é‡Œçš„nameå¹¶ä¸æ˜¯å±æ€§ï¼Œè€Œæ˜¯setæ–¹æ³•åé¢çš„é‚£éƒ¨åˆ†ï¼Œé¦–å­—æ¯å°å†™-->
        <!--å¼•ç”¨å¦å¤–ä¸€ä¸ªbeanï¼Œä¸æ˜¯ç”¨valueè€Œæ˜¯ç”¨ref-->
        <property name="userDao" ref="OracleImpl"/>
    </bean>
</beans>
```

æµ‹è¯•ï¼

```java
1 @Test   
2 public void test2(){   
3 ApplicationContext context  $=$  new   
ClassPathXmlApplicationContext("beans.xml");   
4 ç”¨æˆ·ServiceImpl serviceImpl  $=$  (UserServiceImpl)   
context.getBean("ServiceImpl");   
5 serviceImpl.getUser();   
6 }
```

OKï¼Œåˆ°äº†ç°åœ¨ï¼Œæˆ‘ä»¬å½»åº•ä¸ç”¨å†ç¨‹åºä¸­å»æ”¹åŠ¨äº†ï¼Œè¦å®ç°ä¸åŒçš„æ“ä½œï¼Œåªéœ€è¦åœ¨xmlé…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä¿®æ”¹ï¼Œæ‰€è°“çš„IoC,ä¸€å¥è¯æå®šï¼šå¯¹è±¡ç”±Springæ¥åˆ›å»ºï¼Œç®¡ç†ï¼Œè£…é…ï¼

# 4ã€IOCåˆ›å»ºå¯¹è±¡æ–¹å¼

# 4.1.é€šè¿‡æ— å‚æ„é€ æ–¹æ³•æ¥åˆ›å»º

1. User.java

2. beans.xml

```java
public class User { private String name; public user() { System.out.println("useræ— å‚æ„é€ æ–¹æ³•"); } public void setName(String name) { this.name = name; } public void show(){ System.out.println("name=" + name); }
```

3. æµ‹è¯•ç±»

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans">
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi: schemaLocation="http://www.springframework.org/schema/beans
            http://www.springframework.org-schema/beans/spring-beans.xsd">
        <bean class="com.kuang.pojo.User">
            <property name="name" value="kuangshen"/>
        </bean>
</beans>
```

```txt
1 @Test   
2 public void test(){   
3 ApplicationContext context  $=$  new   
ClassPathXmlApplicationContext("beans.xml");   
4 //åœ¨æ‰§è¡ŒgetBeançš„æ—¶å€™ï¼Œuserå·²ç»åˆ›å»ºå¥½äº†ï¼Œé€šè¿‡æ— å‚æ„é€    
5 User user  $=$  (Userï¼‰context.getBean("user");   
6 //è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼š   
7 user.show();   
8 }
```

ç»“æœå¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨showæ–¹æ³•ä¹‹å‰ï¼ŒUserå¯¹è±¡å·²ç»é€šè¿‡æ— å‚æ„é€ åˆå§‹åŒ–äº†ï¼

# 4.2.é€šè¿‡æœ‰å‚æ„é€ æ–¹æ³•æ¥åˆ›å»º

1. UserT .java

```java
1 public class UserT {
2     private String name;
3         public UserT(String name) {
45         this.name = name;
```

```txt
7 }   
8   
9 public void setName(String name) {   
10 this.name  $=$  name;   
11 }   
12   
13 public void show(){ System.out.println("name  $\equiv$  " + name);   
14 }   
15   
16   
17 }
```

# 2. beans.xmlæœ‰ä¸‰ç§æ–¹å¼ç¼–å†™

```txt
<!-- ç¬¬ä¸€ç§æ ¹æ®indexå‚æ•°ä¸‹æ ‡è®¾ç½® -->
<bean id="userT" class="com.kuang.pojo.UserT">
    <!-- indexæŒ‡æ„é€ æ–¹æ³•ï¼Œä¸‹æ ‡ä»0å¼€å§‹ -->
    <constructor-arg index="0" value="kuangshen2"/>
</bean>
```

```html
1 <!-- ç¬¬äºŒç§æ ¹æ®å‚æ•°åå­—è®¾ç½® -->
2 <bean id="userT" class="com.kuang.pojo.UserT">
3 <!-- nameæŒ‡å‚æ•°å -->
4 <!-- constructor-arg name="name" value="kuangshen2"/>>
5 </bean>
```

```txt
<!-- ç¬¬ä¸‰ç§æ ¹æ®å‚æ•°ç±»å‹è®¾ç½® -->
<bean id="userT" class="com.kuang.pojo.UserT">
    <constructor-arg type="java.lang.String" value="kuangshen2"/>
</bean>
```

# 3. æµ‹è¯•

```java
1 @Test   
2 public void testT(){   
3 ApplicationContext context  $=$  new   
ClassPathXmlApplicationContext("beans.xml");   
4 UserT user  $=$  (UserTï¼‰context.getBean("userT");   
5 user.show();   
6 }
```

ç»“è®ºï¼šåœ¨é…ç½®æ–‡ä»¶åŠ è½½çš„æ—¶å€™ã€‚å…¶ä¸­ç®¡ç†çš„å¯¹è±¡éƒ½å·²ç»åˆå§‹åŒ–äº†ï¼

# 5ã€Springé…ç½®

# 5.1.åˆ«å

alias è®¾ç½®åˆ«åï¼Œä¸ºbeanè®¾ç½®åˆ«åï¼Œå¯ä»¥è®¾ç½®å¤šä¸ªåˆ«å

```html
1 <!--è®¾ç½®åˆ«åï¼šåœ¨è·å–Beançš„æ—¶å€™å¯ä»¥ä½¿ç”¨åˆ«åè·å–--->  
2 <alias name="userT" alias="userNew"/>
```

# 5.2. Beançš„é…ç½®

```txt
<!--beanå°±æ˜¯javaå¯¹è±¡ï¼Œç”±Springåˆ›å»ºå’Œç®¡ç†-->
<!--
id æ˜¯beançš„æ ‡è¯†ç¬¦ï¼Œè¦å”¯ä¸€ï¼Œå¦‚æœæ²¡æœ‰é…ç½®id,nameå°±æ˜¯é»˜è®¤æ ‡è¯†ç¬¦
å¦‚æœé…ç½®idï¼Œåˆé…ç½®äº†nameï¼Œé‚£ä¹ˆnameæ˜¯åˆ«å
nameå¯ä»¥è®¾ç½®å¤šä¸ªåˆ«åï¼Œå¯ä»¥ç”¨é€—å·ï¼Œåˆ†å·ï¼Œç©ºæ ¼éš”å¼€
å¦‚æœä¸é…ç½®idå’Œnameï¼Œå¯ä»¥æ ¹æ®applicationContext.getBean(.class)è·å–å¯¹è±¡;
classæ˜¯beançš„å…¨é™å®šå=åŒ…å+ç±»å
-->  
<bean id="hello" name="hello2 h2, h3;h4" class="com.kuang.pojo.Hello">
    <property name="name" value="Spring"/>
</bean>
```

# 5.3. import

å›¢é˜Ÿçš„åˆä½œé€šè¿‡importæ¥å®ç°ã€‚

```txt
1 <import resource  $=$  {"path}/beans.xml"/>
```

# 6ã€ä¾èµ–æ³¨å…¥ (DI)

- ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection,DIï¼‰ã€‚
- ä¾èµ–ï¼šæŒ‡Beanå¯¹è±¡çš„åˆ›å»ºä¾èµ–äºå®¹å™¨ã€‚Beanå¯¹è±¡çš„ä¾èµ–èµ„æºã€‚
- æ³¨å…¥ï¼šæŒ‡Beanå¯¹è±¡æ‰€ä¾èµ–çš„èµ„æºï¼Œç”±å®¹å™¨æ¥è®¾ç½®å’Œè£…é…ã€‚

# 6.1æ„é€ å™¨æ³¨å…¥

æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ¡ˆä¾‹4å·²ç»è¯¦ç»†è®²è¿‡äº†

# 6.2 setæ³¨å…¥ (é‡ç‚¹)

è¦æ±‚è¢«æ³¨å…¥çš„å±æ€§ï¼Œå¿…é¡»æœ‰setæ–¹æ³•ï¼Œsetæ–¹æ³•çš„æ–¹æ³•åç”±set + å±æ€§é¦–å­—æ¯å¤§å†™ï¼Œå¦‚æœå±æ€§æ˜¯booleanç±»å‹ï¼Œæ²¡æœ‰setæ–¹æ³•ï¼Œæ˜¯is.

æµ‹è¯•pojoç±»ï¼š

Address.java

```java
public class Address { private String address; public String getAddress(){ return address; } public void setAddress(String address){ this.address  $=$  address; }   
12
```

Student.java

```java
package com.kuang.pojo;   
import java.util.List;   
import java.util.Map;   
import java.util.Properties;   
import java.util.Set;   
public class Student { private String name; private Address address; private String[] books; private List<String> hobbies; private Map<String,String> card; private Set<String> games; private String wife; private Properties info; public void setName(String name) { this.name  $=$  name; } public void setAddress(Address address) { this/address  $=$  address; } public void setBooks(String[] books){ this.books  $=$  books; } public void setHobbies(List<String> hobbies) { this.hobbies  $=$  hobbies; } public void setCard(Map<String, String> card) { this.card  $=$  card; } public void setGames(Set<String, String> games) { this/games  $=$  games; } public void setWife(String wife) { this.wife  $=$  wife; } public void setInfo(Properties info) { this.info  $=$  info; } public void show(){ System.out.println("name  $=$  " + name + ",address  $=$  " + address.getAddress() + ",books=" ); for (String book:books){ System.out.print("<<" + book+">>\\t"); }
```

```txt
System.out.println("\nçˆ±å¥½:" + hobbies);  
System.out.println("card:" + card);  
System.out.println("games:" + games);  
System.out.println("wife:" + wife);  
System.out.println("info:" + info);  
}  
70
```

# 1ã€å¸¸é‡æ³¨å…¥

```xml
1 <bean id="student" class="com.kuang.pojo.Student">
2 <property name="name" value="å°æ˜"/>
3 </bean>
```

# æµ‹è¯•ï¼š

```txt
1 @Test   
2 public void test01(){   
3 ApplicationContext context  $=$  new   
ClassPathXmlApplicationContext("applicationContext.xml");   
4 Student student  $=$  (Student) context.getBean("student");   
5 System.out.println(student.getName());   
6   
7   
8   
9 }
```

# 2ã€Beanæ³¨å…¥

æ³¨æ„ç‚¹ï¼šè¿™é‡Œçš„å€¼æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œref

```xml
<bean id="addr" class="com.kuang.pojo_address">
    <property name="address" value="é‡åº†"/>
</bean>
<bean id="student" class="com.kuang.pojo.Student">
    <property name="name" value="å°æ˜"/>
    <property name="address" ref="addr"/>
</bean>
```

# 3ã€æ•°ç»„æ³¨å…¥

```xml
<bean id="student" class="com.kuang.pojo.Student">
    <property name="name" value="å°æ˜"/>
    <property name="address" ref="addr"/>
    <property name="books">
        <array>
            <value>è¥¿æ¸¸è®°</value>
            <value>çº¢æ¥¼æ¢¦</value>
            <value>æ°´æµ’ä¼ </value>
        </array>
    </property>
</bean>
```

# 4ã€Listæ³¨å…¥

```txt
1 <property name="hobbys">   
2 <list>   
3 <value>å¬æ­Œ</value>   
4 <value>çœ‹ç”µå½±</value>   
5 <value>çˆ¬å±±</value>   
6 </list>   
7 </property>
```

# 5ã€Mapæ³¨å…¥

```html
1 <property name="card">   
2 <map>   
3 <entry key  $=$  "ä¸­å›½é‚®æ”¿"value  $=$  "456456456465456"/>   
4 <entry key  $=$  "å»ºè®¾"value  $=$  "1456682255511"/>   
5 </map>   
6 </property>
```

# 6ã€setæ³¨å…¥

```html
1 <property name="games">   
2 <set>   
3 <value>LOL</value>   
4 <value>BOB</value>   
5 <value>COC</value>   
6 </set>   
7 </property>
```

# 7ã€Nullæ³¨å…¥

```html
1 <property name="wife"><null/></property>
```

# 8ã€Propertiesæ³¨å…¥

```txt
1 <property name="info">   
2 <props>   
3 <prop key  $=$  "å­¦å·">20190604</prop>   
4 <prop key  $\equiv$  "æ€§åˆ«">ç”·</prop>   
5 <prop key  $\equiv$  "å§“å">å°æ˜</prop>   
6 </props>   
7 </property>
```

æµ‹è¯•ç»“æœï¼š

```txt
name=å°æ˜, address=é‡åº†, books=  
<<è¥¿æ¸¸è®°>> <<çº¢æ¥¼æ¢¦>> <<æ°´æµ’ä¼ >>  
çˆ±å¥½ï¼š[å¬æ­Œï¼Œçœ‹ç”µå½±ï¼Œçˆ¬å±±]  
card:{ä¸­å›½é‚®æ”¿=456456456465456ï¼Œå»ºè®¾=1456682255511}  
games:[LOLï¼ŒBOBï¼ŒCOC]  
wife:null|  
info:{å­¦å·=20190604ï¼Œæ€§åˆ«=ç”·ï¼Œå§“å=å°æ˜}
```

# 6.3 æ‹“å±•æ³¨å…¥å®ç°

User.javaï¼šã€æ³¨æ„ï¼šè¿™é‡Œæ²¡æœ‰æœ‰å‚æ„é€ å™¨ï¼ã€‘

```java
public class User {
    private String name;
    private int age;
    public void setName(String name) {
        this.name = name;
    }
    public void setAge(int age) {
        this.age = age;
    }
}
```

# 1ã€På‘½åç©ºé—´æ³¨å…¥ï¼šéœ€è¦åœ¨å¤´æ–‡ä»¶ä¸­å‡å¦‚çº¦æŸæ–‡ä»¶

```html
å¯¼å…¥çº¦æŸï¼šxmlns:p="http://www.springframework.org/schema/p"  
<--P(å±æ€§ï¼šproperties)å‘½åç©ºé—´ï¼Œå±æ€§ä¾ç„¶è¦è®¾ç½®setæ–¹æ³•-->  
<bean id="user" class="com.kuang.pojo.User" p:name="ç‹‚ç¥" p:age="18"/>
```

# 2ã€c å‘½åç©ºé—´æ³¨å…¥ï¼šéœ€è¦åœ¨å¤´æ–‡ä»¶ä¸­å‡å¦‚çº¦æŸæ–‡ä»¶

```html
å¯¼å…¥çº¦æŸï¼šxmlns:c="http://www.springframework.org/schema/c"  
<--C(æ„é€ ï¼šConstructor)å‘½åç©ºé—´ï¼Œå±æ€§ä¾ç„¶è¦è®¾ç½®setæ–¹æ³•-->  
<bean id="user" class="com.kuang.pojo.User" c:name="ç‹‚ç¥" c:age="18"/>
```

å‘ç°é—®é¢˜ï¼šçˆ†çº¢äº†ï¼Œåˆšæ‰æˆ‘ä»¬æ²¡æœ‰å†™æœ‰å‚æ„é€ ï¼

è§£å†³ï¼šæŠŠæœ‰å‚æ„é€ å™¨åŠ ä¸Šï¼Œè¿™é‡Œä¹Ÿèƒ½çŸ¥é“ï¼Œc å°±æ˜¯æ‰€è°“çš„æ„é€ å™¨æ³¨å…¥ï¼

æµ‹è¯•ä»£ç ï¼š

```java
1 @Test   
2 public void test02(){   
3 ApplicationContext context  $=$  new   
4 ClassPathXmlApplicationContext("applicationContext.xml");   
5 User user  $=$  (User) context.getBean("user");   
6 System.out.println(user);   
7 }
```

# 6.4 Beançš„ä½œç”¨åŸŸ

åœ¨Springä¸­ï¼Œé‚£äº›ç»„æˆåº”ç”¨ç¨‹åºçš„ä¸»ä½“åŠç”±Spring IoCå®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ï¼Œè¢«ç§°ä¹‹ä¸ºbeanã€‚ç®€å•åœ°è®²ï¼Œbeanå°±æ˜¯ç”±IoCå®¹å™¨åˆå§‹åŒ–ã€è£…é…åŠç®¡ç†çš„å¯¹è±¡ã€‚

<table><tr><td>ç±»åˆ«</td><td>è¯´æ˜</td></tr><tr><td>singleton</td><td>åœ¨Spring IoCå®¹å™¨ä¸­ä»…å­˜åœ¨ä¸€ä¸ªBeanå®ä¾‹ï¼ŒBeanä»¥å•ä¾‹æ–¹å¼å­˜åœ¨ï¼Œé»˜è®¤å€¼</td></tr><tr><td>prototype</td><td>æ¯æ¬¡ä»å®¹å™¨ä¸­è°ƒç”¨Beanæ—¶ï¼Œéƒ½è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå³æ¯æ¬¡è°ƒç”¨getBean()æ—¶ï¼Œç›¸å½“äºæ‰§è¡Œnew XxxBean()</td></tr><tr><td>request</td><td>æ¯æ¬¡HTTPè¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanï¼Œè¯¥ä½œç”¨åŸŸä»…é€‚ç”¨äºWebApplicationContextç¯å¢ƒ</td></tr><tr><td>session</td><td>åŒä¸€ä¸ªHTTP Sessionå…±äº«ä¸€ä¸ªBeanï¼Œä¸åŒSessionä½¿ç”¨ä¸åŒBeanï¼Œä»…é€‚ç”¨äºWebApplicationContextç¯å¢ƒ</td></tr></table>

å‡ ç§ä½œç”¨åŸŸä¸­ï¼Œrequestã€sessionä½œç”¨åŸŸä»…åœ¨åŸºäºwebçš„åº”ç”¨ä¸­ä½¿ç”¨ï¼ˆä¸å¿…å…³å¿ƒä½ æ‰€é‡‡ç”¨çš„æ˜¯ä»€ä¹ˆwebåº”ç”¨æ¡†æ¶ï¼‰ï¼Œåªèƒ½ç”¨åœ¨åŸºäºwebçš„Spring
ApplicationContextç¯å¢ƒã€‚

# 6.4.1 Singleton

å½“ä¸€ä¸ªbeançš„ä½œç”¨åŸŸä¸ºSingletonï¼Œé‚£ä¹ˆSpring
IoCå®¹å™¨ä¸­åªä¼šå­˜åœ¨ä¸€ä¸ªå…±äº«çš„beanå®ä¾‹ï¼Œå¹¶ä¸”æ‰€æœ‰å¯¹beançš„è¯·æ±‚ï¼Œåªè¦idä¸è¯¥beanå®šä¹‰ç›¸åŒ¹é…ï¼Œåˆ™åªä¼šè¿”å›beançš„åŒä¸€å®ä¾‹ã€‚Singletonæ˜¯å•ä¾‹ç±»å‹ï¼Œå°±æ˜¯åœ¨åˆ›å»ºèµ·å®¹å™¨æ—¶å°±åŒæ—¶è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªbeançš„å¯¹è±¡ï¼Œä¸ç®¡ä½ æ˜¯å¦ä½¿ç”¨ï¼Œä»–éƒ½å­˜åœ¨äº†ï¼Œæ¯æ¬¡è·å–åˆ°çš„å¯¹è±¡éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚æ³¨æ„ï¼ŒSingletonä½œç”¨åŸŸæ˜¯Springä¸­çš„ç¼ºçœä½œç”¨åŸŸã€‚è¦åœ¨XMLä¸­å°†beanå®šä¹‰æˆsingletonï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š

```html
1 <bean id="ServiceImpl" class="cn.csdn.service ServiceImpl" scope="singleton">
```

æµ‹è¯•ï¼š

```java
1 @Test   
2 public void test03(){   
3 ApplicationContext context  $=$  new   
ClassPathXmlApplicationContext("applicationContext.xml");   
4 User user  $=$  (User) context.getBean("user");   
5 User user2  $=$  (User) context.getBean("user");   
6 System.out.println(user==user2);   
7 }
```

# 6.4.2 Prototype

å½“ä¸€ä¸ªbeançš„ä½œç”¨åŸŸä¸ºPrototypeï¼Œè¡¨ç¤ºä¸€ä¸ªbeanå®šä¹‰å¯¹åº”å¤šä¸ªå¯¹è±¡å®ä¾‹ã€‚Prototypeä½œç”¨åŸŸçš„beanä¼šå¯¼è‡´åœ¨æ¯æ¬¡å¯¹è¯¥beanè¯·æ±‚ï¼ˆå°†å…¶æ³¨å…¥åˆ°å¦ä¸€ä¸ªbeanä¸­ï¼Œæˆ–è€…ä»¥ç¨‹åºçš„æ–¹å¼è°ƒç”¨å®¹å™¨çš„getBean()
æ–¹æ³•ï¼‰æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ã€‚Prototypeæ˜¯åŸå‹ç±»å‹ï¼Œå®ƒåœ¨æˆ‘ä»¬åˆ›å»ºå®¹å™¨çš„æ—¶å€™å¹¶æ²¡æœ‰å®ä¾‹åŒ–ï¼Œè€Œæ˜¯å½“æˆ‘ä»¬è·å–beançš„æ—¶å€™æ‰ä¼šå»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œè€Œä¸”æˆ‘ä»¬æ¯æ¬¡è·å–åˆ°çš„å¯¹è±¡éƒ½ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚æ ¹æ®ç»éªŒï¼Œå¯¹æœ‰çŠ¶æ€çš„beanåº”è¯¥ä½¿ç”¨prototypeä½œç”¨åŸŸï¼Œè€Œå¯¹æ— çŠ¶æ€çš„beanåˆ™åº”è¯¥ä½¿ç”¨singletonä½œç”¨åŸŸã€‚åœ¨XMLä¸­å°†beanå®šä¹‰æˆprototypeï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š

```xml
1 <bean id="account" class="com.foo.DefaultAccount" scope="prototype"/>  
2 æˆ–è€…  
3 <bean id="account" class="com.foo.DefaultAccount" singleton="false"/>

# 6.4.3 Request

å½“ä¸€ä¸ªbeançš„ä½œç”¨åŸŸä¸ºRequestï¼Œè¡¨ç¤ºåœ¨ä¸€æ¬¡HTTPè¯·æ±‚ä¸­ï¼Œä¸€ä¸ªbeanå®šä¹‰å¯¹åº”ä¸€ä¸ªå®ä¾‹ï¼›å³æ¯ä¸ªHTTPè¯·æ±‚éƒ½ä¼šæœ‰å„è‡ªçš„beanå®ä¾‹ï¼Œå®ƒä»¬ä¾æ®æŸä¸ªbeanå®šä¹‰åˆ›å»ºè€Œæˆã€‚è¯¥ä½œç”¨åŸŸä»…åœ¨åŸºäºwebçš„Springåº”ç”¨åœºæ™¯æƒ…å½¢ä¸‹æœ‰æ•ˆã€‚è€ƒè™‘ä¸‹é¢beanå®šä¹‰ï¼š

```xml
1 <bean id="loginAction" class=cn.csdn LoginAction" scope="request"/>

é’ˆå¯¹æ¯æ¬¡HTTPè¯·æ±‚ï¼ŒSpringå®¹å™¨ä¼šæ ¹æ®loginAction beançš„å®šä¹‰åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„LoginAction beanå®ä¾‹ï¼Œä¸”è¯¥loginAction beanå®ä¾‹ä»…åœ¨å½“å‰HTTP requestå†…æœ‰æ•ˆï¼Œå› æ­¤å¯ä»¥æ ¹æ®éœ€è¦æ”¾å¿ƒçš„æ›´æ”¹æ‰€å»ºå®ä¾‹çš„å†…éƒ¨çŠ¶æ€ï¼Œè€Œå…¶ä»–è¯·æ±‚ä¸­æ ¹æ®loginAction beanå®šä¹‰åˆ›å»ºçš„å®ä¾‹ï¼Œå°†ä¸ä¼šçœ‹åˆ°è¿™äº›ç‰¹å®šäºæŸä¸ªè¯·æ±‚çš„çŠ¶æ€å˜åŒ–ã€‚å½“å¤„ç†è¯·æ±‚ç»“æŸï¼Œrequestä½œç”¨åŸŸçš„beanå®ä¾‹å°†è¢«é”€æ¯ã€‚

# 6.4.4 Session

å½“ä¸€ä¸ªbeançš„ä½œç”¨åŸŸä¸ºSessionï¼Œè¡¨ç¤ºåœ¨ä¸€ä¸ªHTTP Sessionä¸­ï¼Œä¸€ä¸ªbeanå®šä¹‰å¯¹åº”ä¸€ä¸ªå®ä¾‹ã€‚è¯¥ä½œç”¨åŸŸä»…åœ¨åŸºäºwebçš„Spring ApplicationContextæƒ…å½¢ä¸‹æœ‰æ•ˆã€‚è€ƒè™‘ä¸‹é¢beanå®šä¹‰ï¼š

```java
<bean id="userPreferences" class="com.foo.UserPreferences" scope="session"/>

é’ˆå¯¹æŸä¸ªHTTP Sessionï¼ŒSpringå®¹å™¨ä¼šæ ¹æ®userPreferences beanå®šä¹‰åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„userPreferences beanå®ä¾‹ï¼Œä¸”è¯¥userPreferences beanä»…åœ¨å½“å‰HTTP Sessionå†…æœ‰æ•ˆã€‚ä¸requestä½œç”¨åŸŸä¸€æ ·ï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ”¾å¿ƒçš„æ›´æ”¹æ‰€åˆ›å»ºå®ä¾‹çš„å†…éƒ¨çŠ¶æ€ï¼Œè€Œåˆ«çš„HTTP Sessionä¸­æ ¹æ®userPreferencesåˆ›å»ºçš„å®ä¾‹ï¼Œå°†ä¸ä¼šçœ‹åˆ°è¿™äº›ç‰¹å®šäºæŸä¸ªHTTP Sessionçš„çŠ¶æ€å˜åŒ–ã€‚å½“HTTP Sessionæœ€ç»ˆè¢«åºŸå¼ƒçš„æ—¶å€™ï¼Œåœ¨è¯¥HTTP Sessionä½œç”¨åŸŸå†…çš„beanä¹Ÿä¼šè¢«åºŸå¼ƒæ‰ã€‚

# 7ã€Beançš„è‡ªåŠ¨è£…é…

- è‡ªåŠ¨è£…é…æ˜¯ä½¿ç”¨springæ»¡è¶³beanä¾èµ–çš„ä¸€ç§æ–¹æ³•  
- springä¼šåœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ä¸ºæŸä¸ªbeanå¯»æ‰¾å…¶ä¾èµ–çš„beanã€‚

Springä¸­beanæœ‰ä¸‰ç§è£…é…æœºåˆ¶ï¼Œåˆ†åˆ«æ˜¯ï¼š

1. åœ¨xmlä¸­æ˜¾å¼é…ç½®ï¼›  
2. åœ¨javaä¸­æ˜¾å¼é…ç½®ï¼›  
3. éšå¼çš„beanå‘ç°æœºåˆ¶å’Œè‡ªåŠ¨è£…é…ã€‚

è¿™é‡Œæˆ‘ä»¬ä¸»è¦è®²ç¬¬ä¸‰ç§ï¼šè‡ªåŠ¨åŒ–çš„è£…é…beanã€‚

Springçš„è‡ªåŠ¨è£…é…éœ€è¦ä»ä¸¤ä¸ªè§’åº¦æ¥å®ç°ï¼Œæˆ–è€…è¯´æ˜¯ä¸¤ä¸ªæ“ä½œï¼š

1. ç»„ä»¶æ‰«æ(component scanning): springä¼šè‡ªåŠ¨å‘ç°åº”ç”¨ä¸Šä¸‹æ–‡ä¸­æ‰€åˆ›å»ºçš„bean;  
2. è‡ªåŠ¨è£…é…(autowiring): springè‡ªåŠ¨æ»¡è¶³beanä¹‹é—´çš„ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„IoC/DIï¼›

ç»„ä»¶æ‰«æå’Œè‡ªåŠ¨è£…é…ç»„åˆå‘æŒ¥å·¨å¤§å¨åŠ›ï¼Œä½¿çš„æ˜¾ç¤ºçš„é…ç½®é™ä½åˆ°æœ€å°‘ã€‚

æ¨èä¸ä½¿ç”¨è‡ªåŠ¨è£…é…xmlé…ç½®ï¼Œè€Œä½¿ç”¨æ³¨è§£ã€‚

# 7.1ã€æµ‹è¯•ç¯å¢ƒæ­å»º

1. æ–°å»ºä¸€ä¸ªé¡¹ç›®  
2. æ–°å»ºä¸¤ä¸ªå®ä½“ç±»ï¼ŒCat Dog éƒ½æœ‰ä¸€ä¸ªå«çš„æ–¹æ³•

```java
1 public class Cat {
2     public void shout() {
3         System.out.println("miao~");
4         }
5 }
```

```java
1 public class Dog {   
2 public void shout() {   
3 System.out.println("wang~");   
4 }   
5 }
```

3. æ–°å»ºä¸€ä¸ªç”¨æˆ·ç±» User

```txt
1 public class User { 2 private Cat cat; 3 private Dog dog; 4 private String str; 5 }
```

4. ç¼–å†™Springé…ç½®æ–‡ä»¶

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schemabeans">
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi: schemaLocation="http://www.springframework.org/schemabeans(http://www.springframework.org/schemabeans spring-beans.xsd"/>
</bean id="dog" class="com.kuang.pojo.Dog"/>
<bean id="cat" class="com.kuang.pojo.Cat"/>
<bean id="user" class="com.kuang.pojo.User">
    <property name="cat" ref="cat"/>
    <property name="dog" ref="dog"/>
    <property name="str" value="qinjiang"/>
</bean>
</beans>
```

5. æµ‹è¯•

```java
public class MyTest {
    @Test
    public void testMethodAutowire() {
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
        User user = (User) context.getBean("user");
        user.getCat().shout();
        user.getDog().shout();
    }
}
```

ç»“æœæ­£å¸¸è¾“å‡ºï¼Œç¯å¢ƒOK

# 7.2ã€byName

# autowireByName (æŒ‰åç§°è‡ªåŠ¨è£…é…)

ç”±äºåœ¨æ‰‹åŠ¨é…ç½®xmlè¿‡ç¨‹ä¸­ï¼Œå¸¸å¸¸å‘ç”Ÿå­—æ¯ç¼ºæ¼å’Œå¤§å°å†™ç­‰é”™è¯¯ï¼Œè€Œæ— æ³•å¯¹å…¶è¿›è¡Œæ£€æŸ¥ï¼Œä½¿å¾—å¼€å‘æ•ˆç‡é™ä½ã€‚

é‡‡ç”¨è‡ªåŠ¨è£…é…å°†é¿å…è¿™äº›é”™è¯¯ï¼Œå¹¶ä¸”ä½¿é…ç½®ç®€å•åŒ–ã€‚

æµ‹è¯•ï¼š

1. ä¿®æ”¹beané…ç½®ï¼Œå¢åŠ ä¸€ä¸ªå±æ€§ autowire="byName"

```xml
1 <bean id="user" class="com.kuang.pojo.User" autowire="byName">
2 <property name="str" value="qinjiang"/>
3 </bean>
```

2. å†æ¬¡æµ‹è¯•ï¼Œç»“æœä¾æ—§æˆåŠŸè¾“å‡ºï¼
3. æˆ‘ä»¬å°†catçš„bean idä¿®æ”¹ä¸ºcatXXX
4. å†æ¬¡æµ‹è¯•ï¼Œæ‰§è¡Œæ—¶æŠ¥ç©ºæŒ‡é’ˆjava.lang.Null.Exceptionã€‚å› ä¸ºæŒ‰byNameè§„åˆ™æ‰¾ä¸å¯¹åº”setæ–¹æ³•ï¼ŒçœŸæ­£çš„setCatå°±æ²¡æ‰§è¡Œï¼Œå¯¹è±¡å°±æ²¡æœ‰åˆå§‹åŒ–ï¼Œæ‰€ä»¥è°ƒç”¨æ—¶å°±ä¼šæŠ¥ç©ºæŒ‡é’ˆé”™è¯¯ã€‚

# å°ç»“ï¼š

å½“ä¸€ä¸ªbeanèŠ‚ç‚¹å¸¦æœ‰autowirebyNameçš„å±æ€§æ—¶ã€‚

1. å°†æŸ¥æ‰¾å…¶ç±»ä¸­æ‰€æœ‰çš„setæ–¹æ³•åï¼Œä¾‹å¦‚setCatï¼Œè·å¾—å°†setå»æ‰å¹¶ä¸”é¦–å­—æ¯å°å†™çš„å­—ç¬¦ä¸²ï¼Œå³catã€‚
2. å»springå®¹å™¨ä¸­å¯»æ‰¾æ˜¯å¦æœ‰æ­¤å­—ç¬¦ä¸²åç§°idçš„å¯¹è±¡ã€‚
3. å¦‚æœæœ‰ï¼Œå°±å–å‡ºæ³¨å…¥ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±æŠ¥ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚

# 7.3ã€byType

# autowire byType (æŒ‰ç±»å‹è‡ªåŠ¨è£…é…)

ä½¿ç”¨wireé¦–å…ˆéœ€è¦ä¿è¯ï¼šåŒä¸€ç±»å‹çš„å¯¹è±¡ï¼Œåœ¨springå®¹å™¨ä¸­å”¯ä¸€ã€‚å¦‚æœä¸å”¯ä¸€ï¼Œä¼šæŠ¥ä¸å”¯ä¸€çš„å¼‚å¸¸ã€‚

```txt
1 NoUniqueBeanDefinitionException
```

æµ‹è¯•ï¼š

1. å°†userçš„beané…ç½®ä¿®æ”¹ä¸€ä¸‹ï¼š autowire="byType"

2. æµ‹è¯•ï¼Œæ­£å¸¸è¾“å‡º
3. åœ¨æ³¨å†Œä¸€ä¸ªcatçš„beanå¯¹è±¡ï¼

```xml
1 <bean id="dog" class="com.kuang.pojo.Dog">
2 <bean id="cat" class="com.kuang.pojo.Cat">
3 <bean id="cat2" class="com.kuang.pojo.Cat">
4 
5 <bean id="user" class="com.kuang.pojo.User" autowire="byType">
6 <property name="str" value="qinjiang"/>
7 </bean>
```

4. æµ‹è¯•ï¼ŒæŠ¥é”™ï¼šNoUniqueBeanDefinitionException
5. åˆ æ‰cat2ï¼Œå°†catçš„beanåç§°æ”¹æ‰ï¼æµ‹è¯•ï¼å› ä¸ºæ˜¯æŒ‰ç±»å‹è£…é…ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šæŠ¥å¼‚å¸¸ï¼Œä¹Ÿä¸å½±å“æœ€åçš„ç»“æœã€‚ç”šè‡³å°†idå±æ€§å»æ‰ï¼Œä¹Ÿä¸å½±å“ç»“æœã€‚

è¿™å°±æ˜¯æŒ‰ç…§ç±»å‹è‡ªåŠ¨è£…é…ï¼

# 7.4 ä½¿ç”¨æ³¨è§£

jdk1.5å¼€å§‹æ”¯æŒæ³¨è§£ï¼Œspring2.5å¼€å§‹å…¨é¢æ”¯æŒæ³¨è§£ã€‚

å‡†å¤‡å·¥ä½œï¼šåˆ©ç”¨æ³¨è§£çš„æ–¹å¼æ³¨å…¥å±æ€§ã€‚

1. åœ¨springé…ç½®æ–‡ä»¶ä¸­å¼•å…¥contextæ–‡ä»¶å¤´

```html
1 xmlns:context="http://www.springframework.org/schema/context" 2   
3 http://www.springframework.org/schema/context 4 http://www.springframework.org/schema/context/spring-context.xsd
```

2. å¼€å¯å±æ€§æ³¨è§£æ”¯æŒï¼

```txt
1 <context:annotation-config/>
```

# 7.4.1ã€@Autowired

- @Autowiredæ˜¯æŒ‰ç±»å‹è‡ªåŠ¨è½¬é…çš„ï¼Œä¸æ”¯æŒidåŒ¹é…ã€‚
- éœ€è¦å¯¼å…¥ spring-aopçš„åŒ…ï¼

æµ‹è¯•ï¼š

1. å°†Userç±»ä¸­çš„setæ–¹æ³•å»æ‰ï¼Œä½¿ç”¨@Autowiredæ³¨è§£

```java
1 public class User {
2     @Autowired
3     private Cat cat;
4     @Autowired
5     private Dog dog;
6     private String str;
7
8     public Cat getCat()
9         return cat;
10     }
11     public Dog getDog() {
```

```java
12 return dog;   
13 }   
14 public String getStr() {   
15 return str;   
16 }   
17 }
```

# 2. æ­¤æ—¶é…ç½®æ–‡ä»¶å†…å®¹

```txt
1 <context:annotation-config/>   
2   
3 <bean id="dog" class  $=$  "com.kuang.pojo.Dog"/>   
4 <bean id  $=$  "cat" class  $=$  "com.kuang.pojo.Cat"/>   
5 <bean id  $=$  "user" class  $=$  "com.kuang.pojo.User"/>
```

# 3. æµ‹è¯•ï¼ŒæˆåŠŸè¾“å‡ºç»“æœï¼

# ã€å°ç‹‚ç¥ç§‘æ™®æ—¶é—´ã€‘

@Autowired(required=false)è¯´æ˜ï¼šfalseï¼Œå¯¹è±¡å¯ä»¥ä¸ºnullï¼›trueï¼Œå¯¹è±¡å¿…é¡»å­˜å¯¹è±¡ï¼Œä¸èƒ½ä¸ºnullã€‚

```txt
//å¦‚æœå…è®¸å¯¹è±¡ä¸ºnullï¼Œè®¾ç½®required = falseï¼Œé»˜è®¤ä¸ºtrue  
@Autowired(required = false)  
private Cat cat;
```

# 7.4.2ã€@Qualifier

- @Autowiredæ˜¯æ ¹æ®ç±»å‹è‡ªåŠ¨è£…é…çš„ï¼ŒåŠ ä¸Š@Qualifieråˆ™å¯ä»¥æ ¹æ®byNameçš„æ–¹å¼è‡ªåŠ¨è£…é…
- @Qualifierä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚

# æµ‹è¯•å®éªŒæ­¥éª¤ï¼š

1. é…ç½®æ–‡ä»¶ä¿®æ”¹å†…å®¹ï¼Œä¿è¯ç±»å‹å­˜åœ¨å¯¹è±¡ã€‚ä¸”åå­—ä¸ä¸ºç±»çš„é»˜è®¤åå­—ï¼

```txt
1 <bean id="dog1" class="com.kuang.POjo.Dog"/>
2 <bean id="dog2" class="com.kuang.POjo.Dog"/>
3 <bean id="cat1" class="com.kuang.POjo.Cat"/>
4 <bean id="cat2" class="com.kuang.POjo.Cat"/>
```

2. æ²¡æœ‰åŠ Qualifieræµ‹è¯•ï¼Œç›´æ¥æŠ¥é”™

3. åœ¨å±æ€§ä¸Šæ·»åŠ Qualifieræ³¨è§£

```txt
1 @Autowired   
2 @Qualifier(value  $=$  "cat2")   
3 private Cat cat;   
4 @Autowired   
5 @Qualifier(value  $=$  "dog2")   
6 private Dog dog;
```

4. æµ‹è¯•ï¼ŒæˆåŠŸè¾“å‡ºï¼

# 7.4.3ã€@Resource

- @Resourceå¦‚æœ‰æŒ‡å®šçš„nameå±æ€§ï¼Œå…ˆæŒ‰è¯¥å±æ€§è¿›è¡ŒbyNameæ–¹å¼æŸ¥æ‰¾è£…é…ï¼›
- å…¶æ¬¡å†è¿›è¡Œé»˜è®¤çš„byNameæ–¹å¼è¿›è¡Œè£…é…ï¼›

- å¦‚æœä»¥ä¸Šéƒ½ä¸æˆåŠŸï¼Œåˆ™æŒ‰byTypeçš„æ–¹å¼è‡ªåŠ¨è£…é…ã€‚
- éƒ½ä¸æˆåŠŸï¼Œåˆ™æŠ¥å¼‚å¸¸ã€‚

å®ä½“ç±»ï¼š

```java
public class User {
    //å¦‚æœå…è®¸å¯¹è±¡ä¸ºnullï¼Œè®¾ç½®required = falseï¼Œé»˜è®¤ä¸ºtrue
    @Resource(name = "cat2")
    private Cat cat;
    @Resource
    private Dog dog;
    private String str;
}
```

beans.xml  
æµ‹è¯•ï¼šç»“æœOK

```html
1 <bean id="dog" class="com.kuang.pojo.Dog">
2 <bean id="cat1" class="com.kuang.pojo.Cat">
3 <bean id="cat2" class="com.kuang.pojo.Cat">
4 <bean id="user" class="com.kuang.pojo.User">
5
```

é…ç½®æ–‡ä»¶2ï¼šbeans.xmlï¼Œåˆ æ‰cat2

```txt
1 <bean id="dog" class="com.kuang.pojo.Dog">
2 <bean id="cat1" class="com.kuang.pojo.Cat">
3 </bean>
4 </bean>
```

å®ä½“ç±»ä¸Šåªä¿ç•™æ³¨è§£  
ç»“æœï¼šOK  
@Autowiredä¸@Resourceå¼‚åŒï¼š

```txt
1 @Resource  
2 private Cat cat;  
3 @Resource  
4 private Dog dog;
```

ç»“è®ºï¼šå…ˆè¿›è¡ŒbyNameæŸ¥æ‰¾ï¼Œå¤±è´¥ï¼›å†è¿›è¡ŒbyTypeæŸ¥æ‰¾ï¼ŒæˆåŠŸã€‚

# 7.5ã€å°ç»“

1. @Autowiredä¸@Resourceéƒ½å¯ä»¥ç”¨æ¥è£…é…beanã€‚éƒ½å¯ä»¥å†™åœ¨å­—æ®µä¸Šï¼Œæˆ–å†™åœ¨setteræ–¹æ³•ä¸Šã€‚
2.
@Autowiredé»˜è®¤æŒ‰ç±»å‹è£…é…ï¼ˆå±äºspringè§„èŒƒï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹å¿…é¡»è¦æ±‚ä¾èµ–å¯¹è±¡å¿…é¡»å­˜åœ¨ï¼Œå¦‚æœè¦å…è®¸nullå€¼ï¼Œå¯ä»¥è®¾ç½®å®ƒçš„requiredå±æ€§ä¸ºfalseï¼Œå¦‚ï¼š@Autowired(
required=false)ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨åç§°è£…é…å¯ä»¥ç»“åˆ@Qualifieræ³¨è§£è¿›è¡Œä½¿ç”¨
3.
@Resourceï¼ˆå±äºJ2EEå¤è¿”ï¼‰ï¼Œé»˜è®¤æŒ‰ç…§åç§°è¿›è¡Œè£…é…ï¼Œåç§°å¯ä»¥é€šè¿‡nameå±æ€§è¿›è¡ŒæŒ‡å®šã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šnameå±æ€§ï¼Œå½“æ³¨è§£å†™åœ¨å­—æ®µä¸Šæ—¶ï¼Œé»˜è®¤å–å­—æ®µåè¿›è¡ŒæŒ‰ç…§åç§°æŸ¥æ‰¾ï¼Œå¦‚æœæ³¨è§£å†™åœ¨setteræ–¹æ³•ä¸Šé»˜è®¤å–å±æ€§åè¿›è¡Œè£…é…ã€‚å½“æ‰¾ä¸åˆ°ä¸åç§°åŒ¹é…çš„beanæ—¶æ‰æŒ‰ç…§ç±»å‹è¿›è¡Œè£…é…ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœnameå±æ€§ä¸€æ—¦æŒ‡å®šï¼Œå°±åªä¼šæŒ‰ç…§åç§°è¿›è¡Œè£…é…ã€‚

å®ƒä»¬çš„ä½œç”¨ç›¸åŒéƒ½æ˜¯ç”¨æ³¨è§£æ–¹å¼æ³¨å…¥å¯¹è±¡ï¼Œä½†æ‰§è¡Œé¡ºåºä¸åŒã€‚@Autowiredå…ˆbyTypeï¼Œ@Resourceå…ˆ.byNameã€‚

# 8ã€ä½¿ç”¨æ³¨è§£å¼€å‘

# 8.1ã€è¯´æ˜

åœ¨spring4ä¹‹åï¼Œæƒ³è¦ä½¿ç”¨æ³¨è§£å½¢å¼ï¼Œå¿…é¡»å¾—è¦å¼•å…¥aopçš„åŒ…

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350701.jpg)

åœ¨é…ç½®æ–‡ä»¶å½“ä¸­ï¼Œè¿˜å¾—è¦å¼•å…¥ä¸€ä¸ªcontextçº¦æŸ

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans">
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:context="http://www.springframework.org/schema/context"
    xsi: schemaLocation="http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd
    http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context.xsd"
</beans>
```

# 8.2ã€Beançš„å®ç°

æˆ‘ä»¬ä¹‹å‰éƒ½æ˜¯ä½¿ç”¨beançš„æ ‡ç­¾è¿›è¡Œbeanæ³¨å…¥ï¼Œä½†æ˜¯å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨æ³¨è§£ï¼

1. é…ç½®æ‰«æå“ªäº›åŒ…ä¸‹çš„æ³¨è§£

```txt
1 <--æŒ‡å®šæ³¨è§£æ‰«æåŒ…-->   
2 <context:component-scan base-package="com.kuang.pojo"/>
```

2. åœ¨æŒ‡å®šåŒ…ä¸‹ç¼–å†™ç±»ï¼Œå¢åŠ æ³¨è§£

```java
1 @Component("user")  
2 //ç›¸å½“äºé…ç½®æ–‡ä»¶ä¸­ <bean id="user" class="å½“å‰æ³¨è§£çš„ç±»"/>  
3 public class User {  
4 public String name = "ç§¦ç–†";  
5 }
```

3. æµ‹è¯•

```java
1 @Test   
2 public void test(){   
3 ApplicationContext applicationContext  $=$    
4 new ClassPathXmlApplicationContext("beans.xml");   
5 User user  $=$  (User) applicationContext.getBean("user");   
6 System.out.println(user.name);   
7 }
```

# 8.3ã€å±æ€§æ³¨å…¥

ä½¿ç”¨æ³¨è§£æ³¨å…¥å±æ€§

1. å¯ä»¥ä¸ç”¨æä¾›setæ–¹æ³•ï¼Œç›´æ¥åœ¨ç›´æ¥åä¸Šæ·»åŠ @value("å€¼")

```java
1 @Component("user")
2 // ç›¸å½“äºé…ç½®æ–‡ä»¶ä¸­ <bean id="user" class="å½“å‰æ³¨è§£çš„ç±»"/> 
3 public class User {
4 @value("ç§¦ç–†")
5 // ç›¸å½“äºé…ç½®æ–‡ä»¶ä¸­ <name="name" value="ç§¦ç–†"/> 
6 public String name; 
7 }
```

2. å¦‚æœæä¾›äº†setæ–¹æ³•ï¼Œåœ¨setæ–¹æ³•ä¸Šæ·»åŠ @value("å€¼");

```java
1 @Component("user")   
2 public class User {   
3 public string name;   
4   
5   
6 @Value("ç§¦ç–†")   
7 public void setName(String name) { this.name  $=$  name;   
8   
9 }   
10 }
```

# 8.4ã€è¡ç”Ÿæ³¨è§£

æˆ‘ä»¬è¿™äº›æ³¨è§£ï¼Œå°±æ˜¯æ›¿ä»£äº†åœ¨é…ç½®æ–‡ä»¶å½“ä¸­é…ç½®æ­¥éª¤è€Œå·²ï¼æ›´åŠ çš„æ–¹ä¾¿å¿«æ·ï¼

# @Componentä¸‰ä¸ªè¡ç”Ÿæ³¨è§£

ä¸ºäº†æ›´å¥½çš„è¿›è¡Œåˆ†å±‚ï¼ŒSpringå¯ä»¥ä½¿ç”¨å…¶å®ƒä¸‰ä¸ªæ³¨è§£ï¼ŒåŠŸèƒ½ä¸€æ ·ï¼Œç›®å‰ä½¿ç”¨å“ªä¸€ä¸ªåŠŸèƒ½éƒ½ä¸€æ ·ã€‚

- @Controller: webå±‚
- @Service: serviceå±‚
- @Repository: daoå±‚

å†™ä¸Šè¿™äº›æ³¨è§£ï¼Œå°±ç›¸å½“äºå°†è¿™ä¸ªç±»äº¤ç»™Springç®¡ç†è£…é…äº†ï¼

# 8.5ã€è‡ªåŠ¨è£…é…æ³¨è§£

åœ¨Beançš„è‡ªåŠ¨è£…é…å·²ç»è®²è¿‡äº†ï¼Œå¯ä»¥å›é¡¾ï¼

# 8.6ã€ä½œç”¨åŸŸ

@scope

- singleton: é»˜è®¤çš„, Springä¼šé‡‡ç”¨å•ä¾‹æ¨¡å¼åˆ›å»ºè¿™ä¸ªå¯¹è±¡ã€‚å…³é—­å·¥å‚, æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šé”€æ¯ã€‚
- prototype: å¤šä¾‹æ¨¡å¼ã€‚å…³é—­å·¥å‚ï¼Œæ‰€æœ‰çš„å¯¹è±¡ä¸ä¼šé”€æ¯ã€‚å†…éƒ¨çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¼šå›æ”¶

```java
1 @Controller("user")   
2 @scope("prototype")   
3 public class User {   
4 @Value("ç§¦ç–†")   
5 public String name;   
6 }
```

# 8.7ã€å°ç»“

# XMLä¸æ³¨è§£æ¯”è¾ƒ

- XMLå¯ä»¥é€‚ç”¨ä»»ä½•åœºæ™¯ï¼Œç»“æ„æ¸…æ™°ï¼Œç»´æŠ¤æ–¹ä¾¿
- æ³¨è§£ä¸æ˜¯è‡ªå·±æä¾›çš„ç±»ä½¿ç”¨ä¸äº†ï¼Œå¼€å‘ç®€å•æ–¹ä¾¿

# xmlä¸æ³¨è§£æ•´åˆå¼€å‘ï¼šæ¨èæœ€ä½³å®è·µ

- xmlç®¡ç†Bean  
  æ³¨è§£å®Œæˆå±æ€§æ³¨å…¥
- ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥ä¸ç”¨æ‰«æï¼Œæ‰«ææ˜¯ä¸ºäº†ç±»ä¸Šçš„æ³¨è§£

```txt
1 <context:annotation-config/>
```

ä½œç”¨ï¼š

- è¿›è¡Œæ³¨è§£é©±åŠ¨æ³¨å†Œï¼Œä»è€Œä½¿æ³¨è§£ç”Ÿæ•ˆ
- ç”¨äºæ¿€æ´»é‚£äº›å·²ç»åœ¨springå®¹å™¨é‡Œæ³¨å†Œè¿‡çš„beanä¸Šé¢çš„æ³¨è§£ï¼Œä¹Ÿå°±æ˜¯æ˜¾ç¤ºçš„å‘Springæ³¨å†Œ
- å¦‚æœä¸æ‰«æåŒ…ï¼Œå°±éœ€è¦æ‰‹åŠ¨é…ç½®bean
- å¦‚æœä¸åŠ æ³¨è§£é©±åŠ¨ï¼Œåˆ™æ³¨å…¥çš„å€¼ä¸ºnullï¼

# 8.8ã€åŸºäºJavaç±»è¿›è¡Œé…ç½®

JavaConfig åŸæ¥æ˜¯ Spring çš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå®ƒé€šè¿‡ Java ç±»çš„æ–¹å¼æä¾› Bean çš„å®šä¹‰ä¿¡æ¯ï¼Œåœ¨ Spring4 çš„ç‰ˆæœ¬ï¼ŒJavaConfig å·²æ­£å¼æˆä¸º
Spring4 çš„æ ¸å¿ƒåŠŸèƒ½ã€‚

æµ‹è¯•ï¼š

1. ç¼–å†™ä¸€ä¸ªå®ä½“ç±»ï¼ŒDog

```txt
1 @Component //å°†è¿™ä¸ªç±»æ ‡æ³¨ä¸ºSpringçš„ä¸€ä¸ªç»„ä»¶ï¼Œæ”¾åˆ°å®¹å™¨ä¸­ï¼  
2 public class Dog {  
3 public String name = "dog";  
4 }
```

2. æ–°å»ºä¸€ä¸ªconfigé…ç½®åŒ…ï¼Œç¼–å†™ä¸€ä¸ªMyConfigé…ç½®ç±»

```txt
@Configuration //ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»
public class MyConfig {
    @Bean //é€šè¿‡æ–¹æ³•æ³¨å†Œä¸€ä¸ªbeanï¼Œè¿™é‡Œçš„è¿”å›å€¼å°±Beançš„ç±»å‹ï¼Œæ–¹æ³•åå°±æ˜¯beançš„id!
    public Dog dog(){
        return new Dog();
    }
}
```

# 3. æµ‹è¯•

```java
1 @Test   
2 public void test2(){   
3 ApplicationContext applicationContext  $=$  new AnnotationConfigApplicationContext (MyConfig.class);   
4 Dog dog  $=$  Dog)applicationContext.getBean("dog");   
5 System.out.println(dog.name);   
6 }
```

# 4. æˆåŠŸè¾“å‡ºç»“æœï¼

# å¯¼å…¥å…¶ä»–é…ç½®å¦‚ä½•åšå‘¢ï¼Ÿ

1. æˆ‘ä»¬å†ç¼–å†™ä¸€ä¸ªé…ç½®ç±»ï¼

```java
1 @Configuration //ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªé…ç½®ç±»  
2 public class MyConfig2 {  
3 }
```

2. åœ¨ä¹‹å‰çš„é…ç½®ç±»ä¸­æˆ‘ä»¬æ¥é€‰æ‹©å¯¼å…¥è¿™ä¸ªé…ç½®ç±»

```java
1 @Configuration   
2 @Import(MyConfig2.class) //å¯¼å…¥åˆå¹¶å…¶ä»–é…ç½®ç±»ï¼Œç±»ä¼¼äºé…ç½®æ–‡ä»¶ä¸­çš„ inculde æ ‡ç­¾   
3 public class MyConfig {   
4 }   
5 @Bean   
6 public Dog dog(){ return new Dog();   
7 }   
8   
9   
10 }
```

å…³äºè¿™ç§Javaç±»çš„é…ç½®æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨ä¹‹åçš„SpringBootå’ŒSpringCloudä¸­è¿˜ä¼šå¤§é‡çœ‹åˆ°ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“è¿™äº›æ³¨è§£çš„ä½œç”¨å³å¯ï¼

# 9ã€ä»£ç†æ¨¡å¼

ä¸ºä»€ä¹ˆè¦å­¦ä¹ ä»£ç†æ¨¡å¼ï¼Œå› ä¸ºAOPçš„åº•å±‚æœºåˆ¶å°±æ˜¯åŠ¨æ€ä»£ç†ï¼

ä»£ç†æ¨¡å¼ï¼š

- é™æ€ä»£ç†

- åŠ¨æ€ä»£ç†

å­¦ä¹ aopä¹‹å‰ï¼Œæˆ‘ä»¬è¦å…ˆäº†è§£ä¸€ä¸‹ä»£ç†æ¨¡å¼ï¼

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350702.jpg)

# 9.1ã€é™æ€ä»£ç†

# é™æ€ä»£ç†è§’è‰²åˆ†æ

- æŠ½è±¡è§’è‰²ï¼šä¸€èˆ¬ä½¿ç”¨æ¥å£æˆ–è€…æŠ½è±¡ç±»æ¥å®ç°
- çœŸå®è§’è‰²ï¼šè¢«ä»£ç†çš„è§’è‰²
- ä»£ç†è§’è‰²ï¼šä»£ç†çœŸå®è§’è‰²ï¼›ä»£ç†çœŸå®è§’è‰²åï¼Œä¸€èˆ¬ä¼šåšä¸€äº›é™„å±çš„æ“ä½œã€‚
- å®¢æˆ·ï¼šä½¿ç”¨ä»£ç†è§’è‰²æ¥è¿›è¡Œä¸€äº›æ“ä½œã€‚

# ä»£ç å®ç°

Rent.javaå³æŠ½è±¡è§’è‰²

```txt
1 //æŠ½è±¡è§’è‰²ï¼šç§Ÿæˆ¿  
2 public interface Rent {  
3 public void rent();  
4 }
```

Host.javaå³çœŸå®è§’è‰²

```java
1 //çœŸå®è§’è‰²ï¼šæˆ¿ä¸œï¼Œæˆ¿ä¸œè¦å‡ºç§Ÿæˆ¿å­  
2 public class Host implements Rent{  
3 public void rent() {  
4 System.out.println("æˆ¿å±‹å‡ºç§Ÿ");  
5 }  
6 }
```

Proxy.javaå³ä»£ç†è§’è‰²

```txt
//ä»£ç†è§’è‰²ï¼šä¸­ä»‹   
public class Proxy implements Rent { private Host host; public Proxy(){ public Proxy(Host host){ this.host  $=$  host; }
```

Client.javaå³å®¢æˆ·

```java
9   
10 //ç§Ÿæˆ¿   
11 public void rent(){ seeHouse(); host renting; fare();   
15 }   
16 //çœ‹æˆ¿   
17 public void seeHouse(){ System.out.println("å¸¦æˆ¿å®¢çœ‹æˆ¿");   
18 }   
20 //æ”¶ä¸­ä»‹è´¹   
21 public void fare(){ System.out.println("æ”¶ä¸­ä»‹è´¹");   
22 }   
24 }
```

```java
//å®¢æˆ·ç±»ï¼Œä¸€èˆ¬å®¢æˆ·éƒ½ä¼šå»æ‰¾ä»£ç†ï¼   
public class client { public static void main(String[] args) { //æˆ¿ä¸œè¦ç§Ÿæˆ¿ Host host  $=$  new Host(); //ä¸­ä»‹å¸®åŠ©æˆ¿ä¸œ Proxy proxy  $=$  new Proxy(host); //ä½ å»æ‰¾ä¸­ä»‹ï¼ proxy renting(); }   
1
```

åˆ†æï¼šåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½ ç›´æ¥æ¥è§¦çš„å°±æ˜¯ä¸­ä»‹ï¼Œå°±å¦‚åŒç°å®ç”Ÿæ´»ä¸­çš„æ ·å­ï¼Œä½ çœ‹ä¸åˆ°æˆ¿ä¸œï¼Œä½†æ˜¯ä½ ä¾æ—§ç§Ÿåˆ°äº†æˆ¿ä¸œçš„æˆ¿å­é€šè¿‡ä»£ç†ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ä»£ç†æ¨¡å¼ï¼Œç¨‹åºæºè‡ªäºç”Ÿæ´»ï¼Œæ‰€ä»¥å­¦ç¼–ç¨‹çš„äººï¼Œä¸€èˆ¬èƒ½å¤Ÿæ›´åŠ æŠ½è±¡çš„çœ‹å¾…ç”Ÿæ´»ä¸­å‘ç”Ÿçš„äº‹æƒ…ã€‚

# 9.2ã€é™æ€ä»£ç†çš„å¥½å¤„

- å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„çœŸå®è§’è‰²æ›´åŠ çº¯ç²¹. ä¸å†å»å…³æ³¨ä¸€äº›å…¬å…±çš„äº‹æƒ….
- å…¬å…±çš„ä¸šåŠ¡ç”±ä»£ç†æ¥å®Œæˆ. å®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥,
- å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‰©å±•æ—¶å˜å¾—æ›´åŠ é›†ä¸­å’Œæ–¹ä¾¿.

ç¼ºç‚¹ï¼š

- ç±»å¤šäº†ï¼Œå¤šäº†ä»£ç†ç±»ï¼Œå·¥ä½œé‡å˜å¤§äº†ã€‚å¼€å‘æ•ˆç‡é™ä½ã€‚

æˆ‘ä»¬æƒ³è¦é™æ€ä»£ç†çš„å¥½å¤„ï¼Œåˆä¸æƒ³è¦é™æ€ä»£ç†çš„ç¼ºç‚¹ï¼Œæ‰€ä»¥ï¼Œå°±æœ‰äº†åŠ¨æ€ä»£ç†ï¼

# 9.3ã€é™æ€ä»£ç†å†ç†è§£

åŒå­¦ä»¬ç»ƒä¹ å®Œæ¯•åï¼Œæˆ‘ä»¬å†æ¥ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå·©å›ºå¤§å®¶çš„å­¦ä¹ ï¼

ç»ƒä¹ æ­¥éª¤ï¼š

1. åˆ›å»ºä¸€ä¸ªæŠ½è±¡è§’è‰²ï¼Œæ¯”å¦‚å’±ä»¬å¹³æ—¶åšçš„ç”¨æˆ·ä¸šåŠ¡ï¼ŒæŠ½è±¡èµ·æ¥å°±æ˜¯å¢åˆ æ”¹æŸ¥ï¼

2. æˆ‘ä»¬éœ€è¦ä¸€ä¸ªçœŸå®å¯¹è±¡æ¥å®Œæˆè¿™äº›å¢åˆ æ”¹æŸ¥æ“ä½œ

```txt
//æŠ½è±¡è§’è‰²ï¼šå¢åˆ æ”¹æŸ¥ä¸šåŠ¡  
public interfaceäººæ°‘æœåŠ¡ {void add();void delete();void update();void query();}
```

```java
//çœŸå®å¯¹è±¡ï¼Œå®Œæˆå¢åˆ æ”¹æŸ¥æ“ä½œçš„äºº  
public class UserServiceImpl implementsUserService {  
    public void add() {  
        System.out.println("å¢åŠ äº†ä¸€ä¸ªç”¨æˆ·");  
    }  
    public void delete() {  
        System.out.println("åˆ é™¤äº†ä¸€ä¸ªç”¨æˆ·");  
    }  
    public void update() {  
        System.out.println("æ›´æ–°äº†ä¸€ä¸ªç”¨æˆ·");  
    }  
    public void query() {  
        System.out.println("æŸ¥è¯¢äº†ä¸€ä¸ªç”¨æˆ·");  
    }  
}
```

3. éœ€æ±‚æ¥äº†ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦å¢åŠ ä¸€ä¸ªæ—¥å¿—åŠŸèƒ½ï¼Œæ€ä¹ˆå®ç°ï¼

ã€‚æ€è·¯1ï¼šåœ¨å®ç°ç±»ä¸Šå¢åŠ ä»£ç ã€éº»çƒ¦ï¼ã€‘  
æ€è·¯2ï¼šä½¿ç”¨ä»£ç†æ¥åšï¼Œèƒ½å¤Ÿä¸æ”¹å˜åŸæ¥çš„ä¸šåŠ¡æƒ…å†µä¸‹ï¼Œå®ç°æ­¤åŠŸèƒ½å°±æ˜¯æœ€å¥½çš„äº†ï¼

4. è®¾ç½®ä¸€ä¸ªä»£ç†ç±»æ¥å¤„ç†æ—¥å¿—ï¼ä»£ç†è§’è‰²

```java
//ä»£ç†è§’è‰²ï¼Œåœ¨è¿™é‡Œé¢å¢åŠ æ—¥å¿—çš„å®ç°  
public class UserServiceProxy implementsUserService {  
    private ServiceImpl userService;  
    public void setUserService(UserServiceImplç”¨æˆ·æä¾›ï¼‰{  
        this.service =ç”¨æˆ·æä¾›;  
    }  
public void add() {  
        log("add");  
        userService.add();  
}  
public void delete() {  
        log("delete");  
        userService.delete();  
}  
public void update() {  
        log("update");  
        userService.update();  
}
```

5. æµ‹è¯•è®¿é—®ç±»ï¼š

```txt
23 public void query(){ log("query"); userService/query(); }   
28   
29 public void log(string msg){ System.out.println("æ‰§è¡Œäº†"+msg+"æ–¹æ³•"); 30   
31 }   
32   
33 }
```

```java
public class client { public static void main(string[] args) { //çœŸå®ä¸šåŠ¡ UserServiceImpläººæ°‘æœåŠ¡  $=$  newäººæ°‘æœåŠ¡Impl(); //ä»£ç†ç±» UserServiceProxy proxy  $=$  newäººæ°‘æœåŠ¡Proxy(); //ä½¿ç”¨ä»£ç†ç±»å®ç°æ—¥å¿—åŠŸèƒ½ï¼ proxy.setUserService(userService); proxy.add(); }   
1
```

OKï¼Œåˆ°äº†ç°åœ¨ä»£ç†æ¨¡å¼å¤§å®¶åº”è¯¥éƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜äº†ï¼Œé‡ç‚¹å¤§å®¶éœ€è¦ç†è§£å…¶ä¸­çš„æ€æƒ³ï¼›

æˆ‘ä»¬åœ¨ä¸æ”¹å˜åŸæ¥çš„ä»£ç çš„æƒ…å†µä¸‹ï¼Œå®ç°äº†å¯¹åŸæœ‰åŠŸèƒ½çš„å¢å¼ºï¼Œè¿™æ˜¯AOPä¸­æœ€æ ¸å¿ƒçš„æ€æƒ³

ã€èŠèŠAOPï¼šçºµå‘å¼€å‘ï¼Œæ¨ªå‘å¼€å‘ã€‘

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350703.jpg)

# 9.4ã€åŠ¨æ€ä»£ç†

- åŠ¨æ€ä»£ç†çš„è§’è‰²å’Œé™æ€ä»£ç†çš„ä¸€æ ·ã€‚
- åŠ¨æ€ä»£ç†çš„ä»£ç†ç±»æ˜¯åŠ¨æ€ç”Ÿæˆçš„. é™æ€ä»£ç†çš„ä»£ç†ç±»æ˜¯æˆ‘ä»¬æå‰å†™å¥½çš„
- åŠ¨æ€ä»£ç†åˆ†ä¸ºä¸¤ç±»ï¼šä¸€ç±»æ˜¯åŸºäºæ¥å£åŠ¨æ€ä»£ç†ï¼Œä¸€ç±»æ˜¯åŸºäºç±»çš„åŠ¨æ€ä»£ç†

ã€‚åŸºäºæ¥å£çš„åŠ¨æ€ä»£ç†----JDKåŠ¨æ€ä»£ç†  
ã€‚åŸºäºç±»çš„åŠ¨æ€ä»£ç†--cgi  
ã€‚ç°åœ¨ç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯ javassist æ¥ç”ŸæˆåŠ¨æ€ä»£ç† . ç™¾åº¦ä¸€ä¸‹javassist

ã€‚æˆ‘ä»¬è¿™é‡Œä½¿ç”¨DKçš„åŸç”Ÿä»£ç æ¥å®ç°ï¼Œå…¶ä½™çš„é“ç†éƒ½æ˜¯ä¸€æ ·çš„ï¼

JDKçš„åŠ¨æ€ä»£ç†éœ€è¦äº†è§£ä¸¤ä¸ªç±»

æ ¸å¿ƒï¼šInvocationHandler å’Œ Proxyï¼Œæ‰“å¼€DKå¸®åŠ©æ–‡æ¡£çœ‹çœ‹

ã€InvocationHandlerï¼šè°ƒç”¨å¤„ç†ç¨‹åºã€‘

public interface InvocationHandler

InvocationHandleræ˜¯ç”±ä»£ç†å®ä¾‹çš„è°ƒç”¨å¤„ç†ç¨‹åºå®ç°çš„æ¥å£

æ¯ä¸ªä»£ç†å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå…³è”çš„è°ƒç”¨å¤„ç†ç¨‹åºã€‚å½“åœ¨ä»£ç†å®ä¾‹ä¸Šè°ƒç”¨æ–¹æ³•æ—¶ï¼Œæ–¹æ³•è°ƒç”¨å°†è¢«ç¼–ç å¹¶åˆ†æ´¾åˆ°å…¶è°ƒç”¨å¤„ç†ç¨‹åºçš„invokeæ–¹æ³•ã€‚

1 object invoke(object proxy, æ–¹æ³• method, Object[] args);  
2 //å‚æ•°  
3 //proxy - è°ƒç”¨è¯¥æ–¹æ³•çš„ä»£ç†å®ä¾‹  
4 //method
-æ‰€è¿°æ–¹æ³•å¯¹åº”äºè°ƒç”¨ä»£ç†å®ä¾‹ä¸Šçš„æ¥å£æ–¹æ³•çš„å®ä¾‹ã€‚æ–¹æ³•å¯¹è±¡çš„å£°æ˜ç±»å°†æ˜¯è¯¥æ–¹æ³•å£°æ˜çš„æ¥å£ï¼Œå®ƒå¯ä»¥æ˜¯ä»£ç†ç±»ç»§æ‰¿è¯¥æ–¹æ³•çš„ä»£ç†æ¥å£çš„è¶…çº§æ¥å£ã€‚  
5 //args -åŒ…å«çš„æ–¹æ³•è°ƒç”¨ä¼ é€’ä»£ç†å®ä¾‹çš„å‚æ•°å€¼çš„å¯¹è±¡çš„é˜µåˆ—ï¼Œæˆ–nullå¦‚æœæ¥å£æ–¹æ³•æ²¡æœ‰å‚æ•°ã€‚åŸå§‹ç±»å‹çš„å‚æ•°åŒ…å«åœ¨é€‚å½“çš„åŸå§‹åŒ…è£…å™¨ç±»çš„å®ä¾‹ä¸­ï¼Œä¾‹å¦‚java.lang.Integeræˆ–java.lang.Boolean

ã€Proxyï¼šä»£ç†ã€‘

public class Proxy

extends Object

implementsSerializable

Proxyæä¾›äº†åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å’Œå®ä¾‹çš„é™æ€æ–¹æ³•ï¼Œå®ƒä¹Ÿæ˜¯ç”±è¿™äº›æ–¹æ³•åˆ›å»ºçš„æ‰€æœ‰åŠ¨æ€ä»£ç†ç±»çš„è¶…ç±»ã€‚

åŠ¨æ€ä»£ç†ç±»ï¼ˆä»¥ä¸‹ç®€ç§°ä¸ºä»£ç†ç±»ï¼‰æ˜¯ä¸€ä¸ªå®ç°åœ¨ç±»åˆ›å»ºæ—¶åœ¨è¿è¡Œæ—¶æŒ‡å®šçš„æ¥å£åˆ—è¡¨çš„ç±»ï¼Œå…·æœ‰å¦‚ä¸‹æ‰€è¿°çš„è¡Œä¸ºã€‚ä»£ç†æ¥å£æ˜¯ç”±ä»£ç†ç±»å®ç°çš„æ¥å£ã€‚ä»£ç†å®ä¾‹æ˜¯ä»£ç†ç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æ¯ä¸ªä»£ç†å®ä¾‹éƒ½æœ‰ä¸€ä¸ªå…³è”çš„è°ƒç”¨å¤„ç†ç¨‹åºå¯¹è±¡ï¼Œå®ƒå®ç°äº†æ¥å£InvocationHandlerã€‚é€šè¿‡å…¶ä»£ç†æ¥å£ä¹‹ä¸€çš„ä»£ç†å®ä¾‹ä¸Šçš„æ–¹æ³•è°ƒç”¨å°†è¢«åˆ†æ´¾åˆ°å®ä¾‹è°ƒç”¨å¤„ç†ç¨‹åºçš„invokeæ–¹æ³•ï¼Œä¼ é€’ä»£ç†å®ä¾‹ï¼Œjava.lang.reflect.Methodè¢«è°ƒç”¨æ–¹æ³•çš„java.lang.reflect.Methodå¯¹è±¡ä»¥åŠåŒ…å«å‚æ•°çš„ç±»å‹Object
Objectçš„æ•°ç»„ã€‚è°ƒç”¨å¤„ç†ç¨‹åºé€‚å½“åœ°å¤„ç†ç¼–ç æ–¹æ³•è°ƒç”¨ï¼Œå¹¶ä¸”è¿”å›çš„ç»“æœå°†ä½œä¸ºæ–¹æ³•åœ¨ä»£ç†å®ä¾‹ä¸Šè°ƒç”¨çš„ç»“æœè¿”å›ã€‚

```java
public static Object newProxyInstance(ClassLoader loader, class<?>[] interfaces, InvocationHandler h) throws IllegalArgumentException
```

è¿”å›æŒ‡å®šæ¥å£çš„ä»£ç†ç±»çš„å®ä¾‹ï¼Œè¯¥æ¥å£å°†æ–¹æ³•è°ƒç”¨åˆ†æ´¾ç»™æŒ‡å®šçš„è°ƒç”¨å¤„ç†ç¨‹åºã€‚

Proxy.newProxyInstanceå› ä¸ºä¸IllegalArgumentExceptionç›¸åŒçš„åŸå› è€ŒProxy.getProxyClassã€‚

# å‚æ•°

loader - ç±»åŠ è½½å™¨æ¥å®šä¹‰ä»£ç†ç±»

interfaces - ä»£ç†ç±»å®ç°çš„æ¥å£åˆ—è¡¨

h - è°ƒåº¦æ–¹æ³•è°ƒç”¨çš„è°ƒç”¨å¤„ç†å‡½æ•°

# ç»“æœ

å…·æœ‰ç”±æŒ‡å®šçš„ç±»åŠ è½½å™¨å®šä¹‰å¹¶å®ç°æŒ‡å®šæ¥å£çš„ä»£ç†ç±»çš„æŒ‡å®šè°ƒç”¨å¤„ç†ç¨‹åºçš„ä»£ç†å®ä¾‹

# å¼‚å¸¸

IllegalArgumentException - å¦‚æœå¯¹å¯èƒ½ä¼ é€’ç»™ getProxyClassæœ‰ä»»ä½• getProxyClassè¢«è¿å

SecurityException -å¦‚æœå®‰å…¨ç®¡ç†å™¨ï¼ŒSå­˜åœ¨ä»»ä½•ä¸‹åˆ—æ¡ä»¶å¾—åˆ°æ»¡è¶³ï¼š

```javascript
- ç»™å®šçš„loaderæ˜¯nullï¼Œå¹¶ä¸”è°ƒç”¨è€…çš„ç±»åŠ è½½å™¨ä¸æ˜¯nullï¼Œå¹¶ä¸”è°ƒç”¨s.checkPermissionä¸RuntimePermission("getClassLoader")æƒé™æ‹’ç»è®¿é—®ï¼›
```

```txt
- å¯¹äºæ¯ä¸ªä»£ç†æ¥å£ï¼Œintfï¼Œå‘¼å«è€…çš„ç±»åŠ è½½å™¨æ˜¯ä¸ä¸€æ ·çš„æˆ–ç±»åŠ è½½å™¨çš„ç¥–å…ˆintfå’Œè°ƒç”¨s.checkPackageAccess()æ‹’ç»è®¿é—®intfï¼›
```

```txt
- ä»»ä½•ç»™å®šçš„ä»£ç†æ¥å£çš„æ˜¯éå…¬å’Œå‘¼å«è€…ç±»æ˜¯ä¸åœ¨åŒä¸€runtime packageä½œä¸ºéå…¬å…±æ¥å£å’Œè°ƒç”¨s.checkPermissionä¸ReflectPermission("newProxyInPackage.{package name}")æƒé™æ‹’ç»è®¿é—®ã€‚
```

Nullä»¥ä¾†Exception - å¦‚æœ interfacesæ•°ç»„å‚æ•°æˆ–å…¶ä»»ä½•å…ƒç´ æ˜¯ nullï¼Œæˆ–è€…å¦‚æœè°ƒç”¨å¤„ç†ç¨‹åº hæ˜¯ null

ç‰ˆ

```java
1 //ç”Ÿæˆä»£ç†ç±»  
2 public object getProxy(){  
3 return Proxy.newProxyInstance(this.class().getClassLoader(),  
4 rent.class().getInterfaces(), this);  
5 }
```

# ä»£ç å®ç°

æŠ½è±¡è§’è‰²å’ŒçœŸå®è§’è‰²å’Œä¹‹å‰çš„ä¸€æ ·ï¼

Rent.javaå³æŠ½è±¡è§’è‰²

```txt
1 //æŠ½è±¡è§’è‰²ï¼šç§Ÿæˆ¿  
2 public interface Rent {  
3 public void rent();  
4 }
```

Host.javaå³çœŸå®è§’è‰²

```java
1 //çœŸå®è§’è‰²ï¼šæˆ¿ä¸œï¼Œæˆ¿ä¸œè¦å‡ºç§Ÿæˆ¿å­  
2 public class Host implements Rent{  
3 public void rent() {  
4 System.out.println("æˆ¿å±‹å‡ºç§Ÿ");  
5 }  
6 }
```

ProxyInvocationHandler.java å³ä»£ç†è§’è‰²

```java
public class ProxyInvocationHandler implements InvocationHandler { private Rent rent; public void setRent(Rent rent) { this renting  $=$  rent;
```

Client.java

```txt
6 }   
7   
8 //ç”Ÿæˆä»£ç†ç±»ï¼Œé‡ç‚¹æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œè·å–è¦ä»£ç†çš„æŠ½è±¡è§’è‰²ï¼ä¹‹å‰éƒ½æ˜¯ä¸€ä¸ªè§’è‰²ï¼Œç°åœ¨å¯ä»¥ä»£ç†ä¸€ç±»è§’è‰² public object getProxy(){ return Proxy.newProxyInstance(this.class().getClassLoader(), rent.class().getInterfaces(), this); 1   
10   
11   
12   
13   
14 // proxyï¼šä»£ç†ç±» methodï¼šä»£ç†ç±»çš„è°ƒç”¨å¤„ç†ç¨‹åºçš„æ–¹æ³•å¯¹è±¡.   
15 // å¤„ç†ä»£ç†å®ä¾‹ä¸Šçš„æ–¹æ³•è°ƒç”¨å¹¶è¿”å›ç»“æœ @override   
16   
17 public object invoke(Object proxy, Method method, Object[] args) throwsThrowable { seeHouse(); //æ ¸å¿ƒï¼šæœ¬è´¨åˆ©ç”¨åå°„å®ç°ï¼ Object result  $=$  method.invoke(rent, args); fare(); return result;   
2   
3   
4   
5   
6   
7   
8   
9   
10   
11   
12   
13   
14   
15   
16   
17   
18   
19   
20   
21   
22   
23   
24   
25   
26   
27   
28   
29   
30   
31   
32   
33   
34
```

```java
//ç§Ÿå®¢   
public class client {   
public static void main(String[] args) { //çœŸå®è§’è‰² Host host  $=$  new Host(); //ä»£ç†å®ä¾‹çš„è°ƒç”¨å¤„ç†ç¨‹åº ProxyInvocationHandler pih  $=$  new ProxyInvocationHandler(); pih.setRent(host); //å°†çœŸå®è§’è‰²æ”¾ç½®è¿›å»ï¼ Rent proxy  $=$  (Rent)pih.getProxy(); //åŠ¨æ€ç”Ÿæˆå¯¹åº”çš„ä»£ç†ç±»ï¼ proxy renting(); }   
1
```

æ ¸å¿ƒï¼šä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œä¸€èˆ¬ä»£ç†æŸä¸€ç±»ä¸šåŠ¡ï¼Œä¸€ä¸ªåŠ¨æ€ä»£ç†å¯ä»¥ä»£ç†å¤šä¸ªç±»ï¼Œä»£ç†çš„æ˜¯æ¥å£ï¼ã€

# 9.5ã€æ·±åŒ–ç†è§£

æˆ‘ä»¬æ¥ä½¿ç”¨åŠ¨æ€ä»£ç†å®ç°ä»£ç†æˆ‘ä»¬åé¢å†™çš„UserService!

æˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™ä¸€ä¸ªé€šç”¨çš„åŠ¨æ€ä»£ç†å®ç°çš„ç±»ï¼æ‰€æœ‰çš„ä»£ç†å¯¹è±¡è®¾ç½®ä¸ºObjectå³å¯ï¼

```java
public class ProxyInvocationHandler implements InvocationHandler { private object target; public void setTarget(Object target) { this.target = target; //ç”Ÿæˆä»£ç†ç±» public object getProxy(){ return Proxy.newProxyInstance(this.getClass().getClassLoader(), targeticlass().getInterfaces(),this); } // proxyï¼šä»£ç†ç±» // methodï¼šä»£ç†ç±»çš„è°ƒç”¨å¤„ç†ç¨‹åºçš„æ–¹æ³•å¯¹è±¡. public object invoke(Object proxyï¼ŒMethod methodï¼Œobject[] argsï¼‰throws { log(method.getName()); object result  $=$  method.invoke(target, args); return result; } public void log(StringMethodName){ System.out.println("æ‰§è¡Œäº†"+name+"æ–¹æ³•"); }
```

æµ‹è¯•ï¼

```java
public class Test {
public static void main(String[] args) {
    //çœŸå®å¯¹è±¡
   äººæ°‘æœåŠ¡Impläººæ°‘æœåŠ¡ = newäººæ°‘æœåŠ¡Impl();
    //ä»£ç†å¯¹è±¡çš„è°ƒç”¨å¤„ç†ç¨‹åº
    ProxyInvocationHandler pih = new ProxyInvocationHandler();
    pih.setTargetäººæ°‘æœåŠ¡); //è®¾ç½®è¦ä»£ç†çš„å¯¹è±¡
   äººæ°‘æœåŠ¡ proxy = (äººæ°‘æœåŠ¡)pih.getProxy(); //åŠ¨æ€ç”Ÿæˆä»£ç†ç±»!
    proxy.delete();
}
```

ã€æµ‹è¯•ï¼Œå¢åˆ æ”¹æŸ¥ï¼ŒæŸ¥çœ‹ç»“æœã€‘

# 9.6ã€åŠ¨æ€ä»£ç†çš„å¥½å¤„

é™æ€ä»£ç†æœ‰çš„å®ƒéƒ½æœ‰ï¼Œé™æ€ä»£ç†æ²¡æœ‰çš„ï¼Œå®ƒä¹Ÿæœ‰ï¼

- å¯ä»¥ä½¿å¾—æˆ‘ä»¬çš„çœŸå®è§’è‰²æ›´åŠ çº¯ç²¹ã€‚ä¸å†å»å…³æ³¨ä¸€äº›å…¬å…±çš„äº‹æƒ…ã€‚
- å…¬å…±çš„ä¸šåŠ¡ç”±ä»£ç†æ¥å®Œæˆ. å®ç°äº†ä¸šåŠ¡çš„åˆ†å·¥,
- å…¬å…±ä¸šåŠ¡å‘ç”Ÿæ‰©å±•æ—¶å˜å¾—æ›´åŠ é›†ä¸­å’Œæ–¹ä¾¿.
- ä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œä¸€èˆ¬ä»£ç†æŸä¸€ç±»ä¸šåŠ¡
- ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯ä»¥ä»£ç†å¤šä¸ªç±», ä»£ç†çš„æ˜¯æ¥å£!

# 10.1 ä»€ä¹ˆæ˜¯AOP

AOPï¼ˆAspect Oriented
Programmingï¼‰æ„ä¸ºï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œé€šè¿‡é¢„ç¼–è¯‘æ–¹å¼å’Œè¿è¡ŒæœŸåŠ¨æ€ä»£ç†å®ç°ç¨‹åºåŠŸèƒ½çš„ç»Ÿä¸€ç»´æŠ¤çš„ä¸€ç§æŠ€æœ¯ã€‚AOPæ˜¯OOPçš„å»¶ç»­ï¼Œæ˜¯è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ä¸ªçƒ­ç‚¹ï¼Œä¹Ÿæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦å†…å®¹ï¼Œæ˜¯å‡½æ•°å¼ç¼–ç¨‹çš„ä¸€ç§è¡ç”ŸèŒƒå‹ã€‚åˆ©ç”¨AOPå¯ä»¥å¯¹ä¸šåŠ¡é€»è¾‘çš„å„ä¸ªéƒ¨åˆ†è¿›è¡Œéš”ç¦»ï¼Œä»è€Œä½¿å¾—ä¸šåŠ¡é€»è¾‘å„éƒ¨åˆ†ä¹‹é—´çš„è€¦åˆåº¦é™ä½ï¼Œæé«˜ç¨‹åºçš„å¯é‡ç”¨æ€§ï¼ŒåŒæ—¶æé«˜äº†å¼€å‘çš„æ•ˆç‡ã€‚

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350704.jpg)

# 10.2 Aopåœ¨Springä¸­çš„ä½œç”¨

# æä¾›å£°æ˜å¼äº‹åŠ¡ï¼›å…è®¸ç”¨æˆ·è‡ªå®šä¹‰åˆ‡é¢

- æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼šè·¨è¶Šåº”ç”¨ç¨‹åºå¤šä¸ªæ¨¡å—çš„æ–¹æ³•æˆ–åŠŸèƒ½ã€‚å³æ˜¯ï¼Œä¸æˆ‘ä»¬ä¸šåŠ¡é€»è¾‘æ— å…³çš„ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„éƒ¨åˆ†ï¼Œå°±æ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚å¦‚æ—¥å¿—ï¼Œå®‰å…¨ï¼Œç¼“å­˜ï¼Œäº‹åŠ¡ç­‰ç­‰â€¦â€¦
- åˆ‡é¢ (ASPECT) : æ¨ªåˆ‡å…³æ³¨ç‚¹è¢«æ¨¡å—åŒ–çš„ç‰¹æ®Šå¯¹è±¡ã€‚å³, å®ƒæ˜¯ä¸€ä¸ªç±»ã€‚
- é€šçŸ¥ï¼ˆAdviceï¼‰ï¼šåˆ‡é¢å¿…é¡»è¦å®Œæˆçš„å·¥ä½œã€‚å³ï¼Œå®ƒæ˜¯ç±»ä¸­çš„ä¸€ä¸ªæ–¹æ³•ã€‚
- ç›®æ ‡ï¼ˆTargetï¼‰ï¼šè¢«é€šçŸ¥å¯¹è±¡ã€‚
- ä»£ç† (Proxy) : å‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ä¹‹ååˆ›å»ºçš„å¯¹è±¡ã€‚
- åˆ‡å…¥ç‚¹ (PointCut) : åˆ‡é¢é€šçŸ¥æ‰§è¡Œçš„â€œåœ°ç‚¹â€çš„å®šä¹‰ã€‚
- è¿æ¥ç‚¹ (JointPoint) : ä¸åˆ‡å…¥ç‚¹åŒ¹é…çš„æ‰§è¡Œç‚¹ã€‚

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350705.jpg)

SpringAOPä¸­ï¼Œé€šè¿‡Adviceå®šä¹‰æ¨ªåˆ‡é€»è¾‘ï¼ŒSpringä¸­æ”¯æŒ5ç§ç±»å‹çš„Advice:

<table><tr><td>é€šçŸ¥ç±»å‹</td><td>è¿æ¥ç‚¹</td><td>å®ç°æ¥å£</td></tr><tr><td>å‰ç½®é€šçŸ¥</td><td>æ–¹æ³•æ–¹æ³•å‰</td><td>org.springframework.aop.MethodBeforeAdvice</td></tr><tr><td>åç½®é€šçŸ¥</td><td>æ–¹æ³•å</td><td>org.springframework.aop.AfterReturningAdvice</td></tr><tr><td>ç¯ç»•é€šçŸ¥</td><td>æ–¹æ³•å‰å</td><td>org.aopalliance.intercept.MethodInterceptor</td></tr><tr><td>å¼‚å¸¸æŠ›å‡ºé€šçŸ¥</td><td>æ–¹æ³•æŠ›å‡ºå¼‚å¸¸</td><td>org.springframework.aop.ThrowsAdvice</td></tr><tr><td>å¼•ä»‹é€šçŸ¥</td><td>ç±»ä¸­å¢åŠ æ–°çš„æ–¹æ³•å±æ€§</td><td>org.springframework.aop.IntroductionInterceptor</td></tr></table>

å³ Aop åœ¨ä¸æ”¹å˜åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œå»å¢åŠ æ–°çš„åŠŸèƒ½ã€‚

# 10.3 ä½¿ç”¨Springå®ç°Aop

ã€é‡ç‚¹ã€‘ä½¿ç”¨AOPç»‡å…¥ï¼Œéœ€è¦å¯¼å…¥ä¸€ä¸ªä¾èµ–åŒ…ï¼

```txt
1 <-- https://mvnrepository.com/artifact/org aspectj/aspectjweaver -->   
2 <dependency> <groupId>org aspectj</groupId> <artifactId>aspectjweaver</artifactId> <version>1.9.4</version>   
6 </dependency>   
7
```

# ç¬¬ä¸€ç§æ–¹å¼

# é€šè¿‡Spring APIå®ç°

é¦–å…ˆç¼–å†™æˆ‘ä»¬çš„ä¸šåŠ¡æ¥å£å’Œå®ç°ç±»

```txt
public interfaceUserService {
    public void add(){
        public void delete(){
            public void update(){
                public void search(){
                    }
}
```

```java
public classUserServiceImpl implementsUserService{ @override public void add(){ System.out.println("å¢åŠ ç”¨æˆ·"); } @override public void delete(){ System.out.println("åˆ é™¤ç”¨æˆ·"); } @Override public void update(){ System.out.println("æ›´æ–°ç”¨æˆ·"); } @Override public void search(){ System.out.println("æŸ¥è¯¢ç”¨æˆ·"); }
```

ç„¶åå»å†™æˆ‘ä»¬çš„å¢å¼ºç±»ï¼Œæˆ‘ä»¬ç¼–å†™ä¸¤ä¸ªï¼Œä¸€ä¸ªå‰ç½®å¢å¼º ä¸€ä¸ªåç½®å¢å¼º

```java
public class Log implements MethodBeforeAdvice { //methodï¼šè¦æ‰§è¡Œçš„ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• //objectsï¼šè¢«è°ƒç”¨çš„æ–¹æ³•çš„å‚æ•° //objectï¼šç›®æ ‡å¯¹è±¡ @override public void before(Method method,object[] objects,object o) throwsThrowable { System.out.println(o.class()..getName() + "çš„" + method.getName() + "æ–¹æ³•è¢«æ‰§è¡Œäº†"); 10 }
```

```java
public class AfterLog implements AfterReturningAdvice { //returnValue è¿”å›å€¼ //methodè¢«è°ƒç”¨çš„æ–¹æ³• //args è¢«è°ƒç”¨çš„æ–¹æ³•çš„å¯¹è±¡çš„å‚æ•° //target è¢«è°ƒç”¨çš„ç›®æ ‡å¯¹è±¡ @override public void afterReturning(Object returnValue, Method method, Object[] args, object target) throwsThrowable { System.out.println("æ‰§è¡Œäº†" + target-Class()..getName() + "çš„"+method.getName()+"æ–¹æ³•ï¼Œ" + "è¿”å›å€¼ï¼š "+returnValue); } 12
```

æœ€åå»springçš„æ–‡ä»¶ä¸­æ³¨å†Œï¼Œå¹¶å®ç°aopåˆ‡å…¥å®ç°ï¼Œæ³¨æ„å¯¼å…¥çº¦æŸã€‚

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans">
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:aop="http://www.springframework.org/schema/aop"
    xsi: schemaLocation="http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans.xsd
http://www.springframework.org/schema/aop
http://www.springframework.org/schema/aop/spring-aop.xsd">
    <!--æ³¨å†Œbean-->
    <bean id="userService" class="com.kuang.service.UserServiceImpl"/>
    <bean id="log" class="com.kuang.log.Log"/>
    <bean id="afterLog" class="com.kuang.log.AfterLog"/>
</beançš„é…ç½®>
<aop:config>
    <!--åˆ‡å…¥ç‚¹ expression:è¡¨è¾¾å¼åŒ¹é…è¦æ‰§è¡Œçš„æ–¹æ³•-->
    <aop:pointcut id="pointcut" expression="execution(*)
com.kuang.service.UserServiceImpl.*(.))"/>
    <!--æ‰§è¡Œç¯ç»•ï¼›advice-refæ‰§è¡Œæ–¹æ³•ï¼Œpointcut-refåˆ‡å…¥ç‚¹-->
    <aop:advisor advice-ref="log" pointcut-ref="pointcut"/>
    <aop:advisor advice-ref="afterLog" pointcut-ref="pointcut"/>
</aop:config>
</beans>
```

```java
public class MyTest {
    @Test
    public void test(){
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
       äººæ°‘æœåŠ¡ublicService = (äººæ°‘æœåŠ¡)
        context.getBean("userService");
       äººæ°‘æœåŠ¡.search();
    }
}
```

Aopçš„é‡è¦æ€§ï¼šå¾ˆé‡è¦.ä¸€å®šè¦ç†è§£å…¶ä¸­çš„æ€è·¯ï¼Œä¸»è¦æ˜¯æ€æƒ³çš„ç†è§£è¿™ä¸€å—.

Springçš„Aopå°±æ˜¯å°†å…¬å…±çš„ä¸šåŠ¡(æ—¥å¿—ï¼Œå®‰å…¨ç­‰)å’Œé¢†åŸŸä¸šåŠ¡ç»“åˆèµ·æ¥ï¼Œå½“æ‰§è¡Œé¢†åŸŸä¸šåŠ¡æ—¶ï¼Œå°†ä¼šæŠŠå…¬å…±ä¸šåŠ¡åŠ è¿›æ¥.å®ç°å…¬å…±ä¸šåŠ¡çš„é‡å¤åˆ©ç”¨.é¢†åŸŸä¸šåŠ¡æ›´çº¯ç²¹ï¼Œç¨‹åºçŒ¿ä¸“æ³¨é¢†åŸŸä¸šåŠ¡ï¼Œå…¶æœ¬è´¨è¿˜æ˜¯åŠ¨æ€ä»£ç†.

# ç¬¬äºŒç§æ–¹å¼

# è‡ªå®šä¹‰ç±»æ¥å®ç°Aop

ç›®æ ‡ä¸šåŠ¡ç±»ä¸å˜ä¾æ—§æ˜¯userServiceImpl

ç¬¬ä¸€æ­¥ï¼šå†™æˆ‘ä»¬è‡ªå·±çš„ä¸€ä¸ªåˆ‡å…¥ç±»

```java
1 public class DIYPointcut {
2     public void before(){
4         System.out.println("--------æ–¹æ³•æ‰§è¡Œå‰--------");
5         }
6     public void after(){
7         System.out.println("--------æ–¹æ³•æ‰§è¡Œå--------");
8         }
9
10 }
```

# å»springä¸­é…ç½®

```html
1 <--ç¬¬äºŒç§æ–¹å¼è‡ªå®šä¹‰å®ç°--->  
2 <--æ³¨å†Œbean--->  
3 <bean id="diy" class="com.kuang.config.DiyPointcut"/>  
4  
5 <--aopçš„é…ç½®--->  
6 <aop:config>  
7 <--ç¬¬äºŒç§æ–¹å¼ï¼šä½¿ç”¨AOPçš„æ ‡ç­¾å®ç°--->  
8 <aop:aspect ref="diy">  
9 <aop:pointcut id="diyPonitcut" expression="execution({*} com.kuang.service.UserServiceImpl.*())"/>  
10 <aop:before pointcut-ref="diyPonitcut" method="before"/>  
11 <aop:after pointcut-ref="diyPonitcut" method="after"/>  
12 </aop:aspect>  
13 </aop:config>
```

æµ‹è¯•ï¼š

```java
public class MyTest {
    @Test
    public void test(){
        ApplicationContext context = new ClassPathXmlApplicationContext("beans.xml");
       äººæ°‘æœåŠ¡ç”¨æˆ·æä¾›("userService");
        context.getBean("userService");
       äººæ°‘æœåŠ¡.add();
    }
}
```

# ç¬¬ä¸‰ç§æ–¹å¼

# ä½¿ç”¨æ³¨è§£å®ç°

ç¬¬ä¸€æ­¥ï¼šç¼–å†™ä¸€ä¸ªæ³¨è§£å®ç°çš„å¢å¼ºç±»

```java
package com.kuang.config;   
import org aspectj.lang.ProceedingJoinPoint;   
import org aspectj.lang.annotation.After;   
import org aspectj.lang.annotation.Around;   
import org aspectj.lang.annotation Aspect;   
import org aspectj.lang.annotation.Before;   
@Aspect   
public class AnnotationPointcut { @Before("execution(\*com.kuang.service.UserServiceImpl.\*(..))") public void before(){ System.out.println("--------æ–¹æ³•æ‰§è¡Œå‰--------"); } @After("execution(\*com.kuang.service.UserServiceImpl.\*(..))") public void after(){ System.out.println("--------æ–¹æ³•æ‰§è¡Œå--------"); } @Around("execution(\*com.kuang.service.UserServiceImpl.\*(..))") public void around(ProceedingJoinPoint jp) throwsThrowable{ System.out.println("ç¯ç»•å‰"); System.out.println("ç­¾å:" + jp.getSignature()); //æ‰§è¡Œç›®æ ‡æ–¹æ³•proceed Object proceed = jp.proceed(); System.out.println("ç¯ç»•å"); System.out.println(proceed); }   
}
```

ç¬¬äºŒæ­¥ï¼šåœ¨Springé…ç½®æ–‡ä»¶ä¸­ï¼Œæ³¨å†Œbeanï¼Œå¹¶å¢åŠ æ”¯æŒæ³¨è§£çš„é…ç½®

```txt
1 <!--ç¬¬ä¸‰ç§æ–¹å¼:æ³¨è§£å®ç°-->
2 <bean id="annotationPointcut" class="com.kuang.config.AnotationPointcut">
3 <aop:aspectj-autoproxy/>
```

aop:aspectj-autoproxyï¼šè¯´æ˜

```txt
1 é€šè¿‡aopå‘½åç©ºé—´çš„<aop:aspectj-autoproxy />å£°æ˜è‡ªåŠ¨ä¸ºspringå®¹å™¨ä¸­é‚£äº›é…ç½®@aspectJåˆ‡é¢çš„beanåˆ›å»ºä»£ç†ï¼Œç»‡å…¥åˆ‡é¢ã€‚å½“ç„¶ï¼Œspringåœ¨å†…éƒ¨ä¾æ—§é‡‡ç”¨AnnotationAwareAspectJAutoProxyCreatorè¿›è¡Œè‡ªåŠ¨ä»£ç†çš„åˆ›å»ºå·¥ä½œï¼Œä½†å…·ä½“å®ç°çš„ç»†èŠ‚å·²ç»è¢«<aop:aspectj-autoproxy />éšè—èµ·æ¥äº†  
2  
3 <aop:aspectj-autoproxy />æœ‰ä¸€ä¸ªproxy-target-classå±æ€§ï¼Œé»˜è®¤ä¸ºfalseï¼Œè¡¨ç¤ºä½¿ç”¨jdkåŠ¨æ€ä»£ç†ç»‡å…¥å¢å¼ºï¼Œå½“é…ä¸º<aop:aspectj-autoproxy proxy-target-class="true"/>æ—¶ï¼Œè¡¨ç¤ºä½¿ç”¨CGLibåŠ¨æ€ä»£ç†æŠ€æœ¯ç»‡å…¥å¢å¼ºã€‚ä¸è¿‡å³ä½¿proxy-target-classè®¾ç½®ä¸ºfalseï¼Œå¦‚æœç›®æ ‡ç±»æ²¡æœ‰å£°æ˜æ¥å£ï¼Œåˆ™springå°†è‡ªåŠ¨ä½¿ç”¨CGLibåŠ¨æ€ä»£ç†ã€‚
```

# 11ã€æ•´åˆMybatis

# æ­¥éª¤ï¼š

# 1.å¯¼å…¥ç›¸å…³jaråŒ…

1. junit

```xml
1 <dependency>
2 <groupId>jenit</groupId>
3 <artifactId>jenit</artifactId>
4 <version>4.12</version>
5 </dependency>
```

2. mybatis

```xml
1 <dependency>
2 <groupId>org.mybatis</groupId>
3 <artifactId>mybatis</artifactId>
4 <version>3.5.2</version>
5 </dependency>
```

3. mysql-connector-java

```xml
1 <dependency>
2 <groupId>mysql</groupId>
3 <artifactId>mysql-connector-java</artifactId>
4 <version>5.1.47</version>
5 </dependency>
```

4. springç›¸å…³

```xml
1 <dependency>
2 <groupId>org.springframework</groupId>
3 <artifactId>spring-webmc</artifactId>
4 <version>5.1.10.RELEASE</version>
5 </dependency>
6 <dependency>
7 <groupId>org.springframework</groupId>
8 <artifactId>spring-jdbc</artifactId>
9 <version>5.1.10.RELEASE</version>
10 </dependency>
```

5. aspect AOPç»‡å…¥å™¨

```xml
1 <--https://mvnrepository.com/artifact/org aspectj/aspectjweaver -->   
2 <dependency>   
3 <groupId>org-aspectj</groupId>   
4 <artifactId>aspectjweaver</artifactId>   
5 <version>1.9.4</version>   
6 </dependency>
```

6. mybatis-springæ•´åˆåŒ…ã€é‡ç‚¹ã€‘

```xml
1 <dependency>
2 <groupId>org.mybatis</groupId>
3 <artifactId>mybatis-spring</artifactId>
4 <version>2.0.2</version>
5 </dependency>
```

7. é…ç½®Mavené™æ€èµ„æºè¿‡æ»¤é—®é¢˜ï¼

```xml
1 <build>   
2 <resources>   
3 <resource>   
4 <directory>src/main/java</directory>   
5 <includes>   
6 <include>**/*.properties</include>   
7 <include>**/*.xml</include>   
8 </includes>   
9 </filtering>true</filtering>   
10 </resource>   
11 </resources>   
12 </build>
```

2. ç¼–å†™é…ç½®æ–‡ä»¶

3. ä»£ç å®ç°

# å›å¿†MyBatis

# ç¼–å†™pojoå®ä½“ç±»

```java
1 package com.kuang.pojo;   
2   
3 public class User {   
4 private int id; //id   
5 private String name; //å§“å   
6 private String pwd; //å¯†ç    
7 }
```

# å®ç°mybatisçš„é…ç½®æ–‡ä»¶

```xml
<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE configuration  
PUBLIC "-//mybatis.org//DTD Config 3.0//EN"  
"http://mybatis.org/dtd/mybatis-3-config.dtd">  
<configuration>  
(typeAliases>  
package name="com.kuang.pojo"/>  
</typeAliases>
```

UserDaoæ¥å£ç¼–å†™

```xml
11 <environments default="development">   
12 <environment id="development">   
13 <transactionManager type  $=$  "JDBC"/>   
14 <dataSource type  $=$  "POOLED">   
15 <property name  $=$  "driver" value  $=$  "com.mysql.jdbc.Driver"/>   
16 <property name  $=$  "url"   
value  $=$  "jdbc:mysql://localhost:3306/mybatis?   
useSSL  $\equiv$  true&amp;useUnicode  $\equiv$  true&amp;characterEncoding  $\equiv$  utf8"/>   
17 <property name  $=$  "username" value  $=$  "root"/>   
18 <property name  $=$  "password" value  $=$  "123456"/>   
19 </dataSource>   
20 </environment>   
21 </environments>   
22   
23 <mappers>   
24 <package name  $=$  "com.kuang.dao"/>   
25 </mappers>   
26 </configuration>
```

æ¥å£å¯¹åº”çš„Mapperæ˜ å°„æ–‡ä»¶

```cs
1 public interface UserMapper {   
2 public List<User> selectUser();   
3 }
```

æµ‹è¯•ç±»

```xml
<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE mapper  
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="com.kuangDAO.UserMapper">  
<select id="selectUser" resultType="User">  
    select * from user  
</select>  
</mapper>
```

```java
1 @Test   
2 public void selectUser() throws IOException {   
3 String resource  $=$  "mybatis-config.xml";   
4 InputStream inputStream  $\equiv$  Resources.getResourceAsStream(resource);   
5   
6 SQLFactory sqlSessionFactory  $\equiv$  new   
7   
8   
9   
10   
11   
12   
13   
14   
15   
16 sqlSession.close();
```

# MyBatis-Springå­¦ä¹ 

å¼•å…¥Springä¹‹å‰éœ€è¦äº†è§£mybatis-springåŒ…ä¸­çš„ä¸€äº›é‡è¦ç±»ï¼›

http://www.mybatis.org/spring/zh/index.html

# mybatis-spring

![](https://cdn.jsdelivr.net/gh/mayuhaos/blog-images@main/pdf-ocr-images/20251129152350706.jpg)

# MyBatis

# ä»€ä¹ˆæ˜¯MyBatis-Spring?

MyBatis-Springä¼šå¸®åŠ©ä½ å°†MyBatisä»£ç æ— ç¼åœ°æ•´åˆåˆ°Springä¸­ã€‚

# çŸ¥è¯†åŸºç¡€

åœ¨å¼€å§‹ä½¿ç”¨ MyBatis-Spring ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆç†Ÿæ‚‰ Spring å’Œ MyBatis è¿™ä¸¤ä¸ªæ¡†æ¶å’Œæœ‰å…³å®ƒä»¬çš„æœ¯è¯­ã€‚è¿™å¾ˆé‡è¦

MyBatis-Spring éœ€è¦ä»¥ä¸‹ç‰ˆæœ¬:

<table><tr><td>MyBatis-Spring</td><td>MyBatis</td><td>Spring æ¡†æ¶</td><td>Spring Batch</td><td>Java</td></tr><tr><td>2.0</td><td>3.5+</td><td>5.0+</td><td>4.0+</td><td>Java 8+</td></tr><tr><td>1.3</td><td>3.4+</td><td>3.2.2+</td><td>2.1+</td><td>Java 6+</td></tr></table>

å¦‚æœä½¿ç”¨Mavenä½œä¸ºæ„å»ºå·¥å…·ï¼Œä»…éœ€è¦åœ¨pom.xmlä¸­åŠ å…¥ä»¥ä¸‹ä»£ç å³å¯ï¼š

```xml
1 <dependency>
2 <groupId>org.mybatis</groupId>
3 <artifactId>mybatis-spring</artifactId>
4 <version>2.0.2</version>
5 </dependency>
```

è¦å’Œ Spring ä¸€èµ·ä½¿ç”¨ MyBatisï¼Œéœ€è¦åœ¨ Spring åº”ç”¨ä¸Šä¸‹æ–‡ä¸­å®šä¹‰è‡³å°‘ä¸¤æ ·ä¸œè¥¿ï¼šä¸€ä¸ª

SqlSessionFactory å’Œè‡³å°‘ä¸€ä¸ªæ•°æ®æ˜ å°„å™¨ç±»ã€‚

åœ¨MyBatis-Springä¸­ï¼Œå¯ä½¿ç”¨SQLFactoryBeanæ¥åˆ›å»ºSQLFactoryã€‚è¦é…ç½®è¿™ä¸ªå·¥å‚beanï¼Œåªéœ€è¦æŠŠä¸‹é¢ä»£ç æ”¾åœ¨Springçš„XMLé…ç½®æ–‡ä»¶ä¸­ï¼š

```txt
<bean id="sqlFactory" class="org.mybatis.spring.SqlFactoryBean">
    <property name="dataSource" ref="dataSource" />
</bean>
```

æ³¨æ„ï¼šSQLSessionFactory éœ€è¦ä¸€ä¸ª DataSourceï¼ˆæ•°æ®æºï¼‰ã€‚è¿™å¯ä»¥æ˜¯ä»»æ„çš„

DataSourceï¼Œåªéœ€è¦å’Œé…ç½®å…¶å®ƒ Spring æ•°æ®åº“è¿æ¥ä¸€æ ·é…ç½®å®ƒå°±å¯ä»¥äº†ã€‚

åœ¨åŸºç¡€çš„ MyBatis ç”¨æ³•ä¸­ï¼Œæ˜¯é€šè¿‡ SQLSessionFactoryBuilder æ¥åˆ›å»º SQLSessionFactory

çš„ã€‚è€Œåœ¨ MyBatis-Spring ä¸­ï¼Œåˆ™ä½¿ç”¨ SQLSessionFactoryBean æ¥åˆ›å»ºã€‚

åœ¨MyBatisä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨SQLSessionFactoryæ¥åˆ›å»ºSQLSessionã€‚ä¸€æ—¦ä½ è·å¾—ä¸€ä¸ªsessionä¹‹åï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥æ‰§è¡Œæ˜ å°„äº†çš„è¯­å¥ï¼Œæäº¤æˆ–å›æ»šè¿æ¥ï¼Œæœ€åï¼Œå½“ä¸å†éœ€è¦å®ƒçš„æ—¶å€™ï¼Œä½ å¯ä»¥å…³é—­sessionã€‚

```sql
SqlSessionFactory æœ‰ä¸€ä¸ªå”¯ä¸€çš„å¿…è¦å±æ€§ï¼šç”¨äºJDBCçš„DataSourceã€‚è¿™å¯ä»¥æ˜¯ä»»æ„çš„
DataSource å¯¹è±¡ï¼Œå®ƒçš„é…ç½®æ–¹æ³•å’Œå…¶å®ƒSpringæ•°æ®åº“è¿æ¥æ˜¯ä¸€æ ·çš„ã€‚

ä¸€ä¸ªå¸¸ç”¨çš„å±æ€§æ˜¯ configLocationï¼Œå®ƒç”¨æ¥æŒ‡å®š MyBatis çš„ XML é…ç½®æ–‡ä»¶è·¯å¾„ã€‚å®ƒåœ¨éœ€è¦ä¿®æ”¹ MyBatis çš„åŸºç¡€é…ç½®éå¸¸æœ‰ç”¨ã€‚é€šå¸¸ï¼ŒåŸºç¡€é…ç½®æŒ‡çš„æ˜¯ <settings> æˆ– <typeAliases> å…ƒç´ ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶å¹¶ä¸éœ€è¦æ˜¯ä¸€ä¸ªå®Œæ•´çš„ MyBatis é…ç½®ã€‚ç¡®åˆ‡åœ°è¯´ï¼Œä»»ä½•ç¯å¢ƒé…ç½®ï¼ˆ<environments>ï¼‰ï¼Œæ•°æ®æºï¼ˆ<DataSource>ï¼‰å’Œ MyBatis çš„äº‹åŠ¡ç®¡ç†å™¨

( transactionManager> ) éƒ½ä¼šè¢«å¿½ç•¥ã€‚SqlSessionFactoryBean ä¼šåˆ›å»ºå®ƒè‡ªæœ‰çš„ MyBatis ç¯å¢ƒé…ç½®ï¼ˆEnvironmentï¼‰ï¼Œå¹¶æŒ‰è¦æ±‚è®¾ç½®è‡ªå®šä¹‰ç¯å¢ƒçš„å€¼ã€‚

SqlSessionTemplate æ˜¯ MyBatis-Spring çš„æ ¸å¿ƒã€‚ä½œä¸º SQLSession çš„ä¸€ä¸ªå®ç°ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä½¿ç”¨å®ƒæ— ç¼ä»£æ›¿ä½ ä»£ç ä¸­å·²ç»åœ¨ä½¿ç”¨çš„ sqlSessionã€‚

æ¨¡æ¿å¯ä»¥å‚ä¸åˆ° Spring çš„äº‹åŠ¡ç®¡ç†ä¸­ï¼Œå¹¶ä¸”ç”±äºå…¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥ä¾›å¤šä¸ªæ˜ å°„å™¨ç±»ä½¿ç”¨ï¼Œä½ åº”è¯¥æ€»æ˜¯ç”¨ `SqlSessionTemplate` æ¥æ›¿æ¢ MyBatis é»˜è®¤çš„ `DefaultSqlSession` å®ç°ã€‚åœ¨åŒä¸€åº”ç”¨ç¨‹åºä¸­çš„ä¸åŒç±»ä¹‹é—´æ··æ‚ä½¿ç”¨å¯èƒ½ä¼šå¼•èµ·æ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜ã€‚

å¯ä»¥ä½¿ç”¨ SQLSessionFactory ä½œä¸ºæ„é€ æ–¹æ³•çš„å‚æ•°æ¥åˆ›å»º SQLSessionTemplate å¯¹è±¡ã€‚

```html
bean id="sqlSession" class="org.mybatis.spring.SqlSessionTemplate">
    <constructor-arg index="0" ref="sqlSessionFactory" />
</bean>
```

ç°åœ¨ï¼Œè¿™ä¸ªbeanå°±å¯ä»¥ç›´æ¥æ³¨å…¥åˆ°ä½ çš„DAO beanä¸­äº†ã€‚ä½ éœ€è¦åœ¨ä½ çš„beanä¸­æ·»åŠ ä¸€ä¸ªSqlSessionå±æ€§ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```java
public class UserDaoImpl implements UserDao { private sqSession sqSession; public void setSqSession (sqSession sqSession) { this.sqlSession = sqSession; } public user.getUser(String userId) { return sqSession.getMapper...; }
```

æŒ‰ä¸‹é¢è¿™æ ·ï¼Œæ³¨å…¥ï¼š

```xml
1 <bean id="userDao" class="org.mybatis.spring.sample DAO.UserDaoImpl">
2 <property name="sqlSession" ref="sqlSession" />
3 </bean>
```

# æ•´åˆå®ç°ä¸€

1. å¼•å…¥Springé…ç½®æ–‡ä»¶beans.xml

2. é…ç½®æ•°æ®æºæ›¿æ¢mybaitsçš„æ•°æ®æº

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans">
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi: schemaLocation="http://www.springframework.org/schema/beans"
    http://www.springframework.org/schema/beans/spring-beans.xsd">
```

3. é…ç½®SqlSessionFactoryï¼Œå…³è”MyBatis

```xml
<bean id="dataSource" class="org.springframework JDBC.DataSource.DriverManagerDataSource">
    <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
    <property name="url" value="jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;useUnicode=true&amp;characterEncodingutf8"/>
    <property name="username" value="root"/>
    <property name="password" value="123456"/>
</bean>
```

4. æ³¨å†ŒsqlSessionTemplateï¼Œå…³è”sqlSessionFactory;

```html
1 <!--é…ç½®SqlSessionFactory-->
2 <bean id="sqlSessionFactory"
3 class="org.mybatis.spring.SqlSessionFactoryBean">
4 <!--å…³è”Mybatis-->
5 <property name="dataSource" ref="dataSourceâ€ />
6 <!--mapperLocations")
value="classpath:mybatis-">
7 </bean>
```

5. å¢åŠ Daoæ¥å£çš„å®ç°ç±»ï¼›ç§æœ‰åŒ–sqlSessionTemplate

```html
1 <!--æ³¨å†ŒsqlSessionTemplateï¼Œå…³è”sqlSessionFactory-->
2 <bean id="sqlSession" class="org.mybatis.spring.SqlSessionTemplate">
3 <!--åˆ©ç”¨æ„é€ å™¨æ³¨å…¥-->
4 <constructor-arg index="0" ref="sqlSessionFactory"/>
5 </bean>
```

```java
public class UserDaoImpl implements UserMapper { //sqlSessionä¸ç”¨æˆ‘ä»¬è‡ªå·±åˆ›å»ºäº†ï¼Œspringæ¥ç®¡ç† private SQLSessionTemplate sqlSession; public void setsqlsession (sqlSessionTemplate sqlSession) { this.sqlSession = sqlSession; } public List <User> selectUser() { UserMapper mapper  $=$  sqlSession.getMapper(UserMapper.class); return mapper.selectUser(); }   
15
```

# 6. æ³¨å†Œbeanå®ç°

```txt
1 <bean id="userDao" class="com.kuangDAO.UserDaoImpl">
2 <property name="sqlSession" ref="sqlSession"/>
3 </bean>
```

# 7. æµ‹è¯•

```java
1 @Test   
2 public void test2(){   
3 ApplicationContext context  $=$  new   
ClassPathXmlApplicationContext("beans.xml");   
4 UserMapper mapper  $=$  (UserMapper) context.getBean("userDao");   
5 List<User> user  $=$  mapper.selectUser();   
6 System.out.println(user);   
7 }
```

ç»“æœæˆåŠŸè¾“å‡ºï¼ç°åœ¨æˆ‘ä»¬çš„Mybatisé…ç½®æ–‡ä»¶çš„çŠ¶æ€ï¼å‘ç°éƒ½å¯ä»¥è¢«Springæ•´åˆï¼

```xml
<?xml version="1.0" encoding="UTF-8"?>  
<!DOCTYPE configuration  
PUBLIC "/~/mybatis.org//DTD Config 3.0//EN"  
"http://mybatis.org/dtd/mybatis-3-config.dtd">  
<configuration>  
(typeAliases>  
<package name="com.kuang.pojo"/>  
</typeAliases>  
</configuration>
```

# æ•´åˆå®ç°äºŒ

mybatis-spring1.2.3ç‰ˆä»¥ä¸Šçš„æ‰æœ‰è¿™ä¸ªã€‚

å®˜æ–¹æ–‡æ¡£æˆªå›¾ï¼š

daoç»§æ‰¿Supportç±»ï¼Œç›´æ¥åˆ©ç”¨getSqlSession()è·å¾—ï¼Œç„¶åç›´æ¥æ³¨å…¥SqlSessionFactory.æ¯”èµ·æ–¹å¼1ï¼Œä¸éœ€è¦ç®¡ç†SqlSessionTemplateï¼Œè€Œä¸”å¯¹äº‹åŠ¡çš„æ”¯æŒæ›´åŠ å‹å¥½.å¯è·Ÿè¸ªæºç æŸ¥çœ‹

# SqlSessionDaoSupport

SqlSessionDaoSupport æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ”¯æŒç±»ï¼Œç”¨æ¥ä¸ºä½ æä¾› SqlConnectionã€‚è°ƒç”¨ getSQISession() æ–¹æ³•ä½ ä¼šå¾—åˆ°ä¸€ä¸ª
SqlConnectionTemplateï¼Œä¹‹åå¯ä»¥ç”¨äºæ‰§è¡Œ SQL æ–¹æ³•ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š

```java
public class UserDaoImpl extends DaoSessionDaoSupport implements UserDao { publicUsergetUserID){ returngetSqlSession().selectOne("org.mybatis.spring.sample mapper.UserMapper.getUserUser"ï¼ŒUserID); }   
1
```

åœ¨è¿™ä¸ªç±»é‡Œé¢ï¼Œé€šå¸¸æ›´å€¾å‘äºä½¿ç”¨ MapperFactoryBeanï¼Œå› ä¸ºå®ƒä¸éœ€è¦é¢å¤–çš„ä»£ç ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦åœ¨ DAO ä¸­åšå…¶å®ƒé MyBatis
çš„å·¥ä½œæˆ–éœ€è¦ä¸€ä¸ªéæŠ½è±¡çš„å®ç°ç±»ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±å¾ˆæœ‰ç”¨äº†ã€‚

SqlSessionDaoSupport éœ€è¦é€šè¿‡å±æ€§è®¾ç½®ä¸€ä¸ª sqlSessionFactory æˆ–sqlSessionTemplateã€‚å¦‚æœä¸¤ä¸ªå±æ€§éƒ½è¢«è®¾ç½®äº†ï¼Œé‚£ä¹ˆ
SQLSessionFactory å°†è¢«å¿½ç•¥ã€‚

å‡è®¾ç±»UserMapperImplæ˜¯SqlSessionDaoSupportçš„å­ç±»ï¼Œå¯ä»¥ç¼–å†™å¦‚ä¸‹çš„Springé…ç½®æ¥æ‰§è¡Œè®¾ç½®ï¼š

```txt
<bean id="userDao" class="org.mybatis.spring.sample DAO.UserDaoImpl">
    <property name="sqlSessionFactory" ref="sqlSessionFactory" />
</bean>
```

# æµ‹è¯•ï¼š

1. å°†æˆ‘ä»¬ä¸Šé¢å†™çš„UserDaoImplä¿®æ”¹ä¸€ä¸‹

```java
public class UserDaoImpl extends DaoSessionDaoSupport implements UserMapper {
    public List<user> selectUser() {
        UserMapper mapper = getSession().getMapper(UserMapper.class);
        return mapper.selectUser();
    }
}
```

# 2. ä¿®æ”¹beançš„é…ç½®

```html
1 <bean id="userDao" class="com.kuang DAO.UserDaoImpl">
2 <property name="sqlSessionFactory" ref="sqlSessionFactory" />
3 </bean>
```

# 3. æµ‹è¯•

```java
1 @Test   
2 public void test2(){   
3 ApplicationContext context  $=$  new   
ClassPathXmlApplicationContext("beans.xml");   
4 UserMapper mapper  $=$  (UserMapper) context.getBean("userDao");   
5 List<User> user  $=$  mapper.selectUser();   
6 System.out.println(user);   
7 }
```

æ€»ç»“ï¼šæ•´åˆåˆ°springä¸­ä»¥åå¯ä»¥å®Œå…¨ä¸è¦mybatisçš„é…ç½®æ–‡ä»¶ï¼Œé™¤äº†è¿™äº›æ–¹å¼å¯ä»¥å®ç°æ•´åˆä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥å®ç°ï¼Œè¿™ä¸ªç­‰æˆ‘ä»¬åé¢å­¦ä¹ SpringBootçš„æ—¶å€™è¿˜ä¼šæµ‹è¯•æ•´åˆï¼

# 12ã€å£°æ˜å¼äº‹åŠ¡

# 12.1ã€å›é¡¾äº‹åŠ¡

- äº‹åŠ¡åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹éå¸¸é‡è¦ï¼Œæ¶‰åŠåˆ°æ•°æ®çš„ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä¸å®¹é©¬è™ï¼
- äº‹åŠ¡ç®¡ç†æ˜¯ä¼ä¸šçº§åº”ç”¨ç¨‹åºå¼€å‘ä¸­å¿…å¤‡æŠ€æœ¯ï¼Œç”¨æ¥ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚

äº‹åŠ¡å°±æ˜¯æŠŠä¸€ç³»åˆ—çš„åŠ¨ä½œå½“æˆä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œå•å…ƒï¼Œè¿™äº›åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸èµ·ä½œç”¨ã€‚

# äº‹åŠ¡å››ä¸ªå±æ€§ACID

1. åŸå­æ€§ (atomicity)

â€¢ äº‹åŠ¡æ˜¯åŸå­æ€§æ“ä½œï¼Œç”±ä¸€ç³»åˆ—åŠ¨ä½œç»„æˆï¼Œäº‹åŠ¡çš„åŸå­æ€§ç¡®ä¿åŠ¨ä½œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå®Œå…¨ä¸èµ·ä½œç”¨

2.ä¸€è‡´æ€§ (consistency)  
ã€‚ä¸€æ—¦æ‰€æœ‰äº‹åŠ¡åŠ¨ä½œå®Œæˆï¼Œäº‹åŠ¡å°±è¦è¢«æäº¤ã€‚æ•°æ®å’Œèµ„æºå¤„äºä¸€ç§æ»¡è¶³ä¸šåŠ¡è§„åˆ™çš„ä¸€è‡´æ€§çŠ¶æ€ä¸­

3. éš”ç¦»æ€§ (isolation)

- å¯èƒ½å¤šä¸ªäº‹åŠ¡ä¼šåŒæ—¶å¤„ç†ç›¸åŒçš„æ•°æ®ï¼Œå› æ­¤æ¯ä¸ªäº‹åŠ¡éƒ½åº”è¯¥ä¸å…¶ä»–äº‹åŠ¡éš”ç¦»å¼€æ¥ï¼Œé˜²æ­¢æ•°æ®æŸå

4. æŒä¹…æ€§ (durability)

- äº‹åŠ¡ä¸€æ—¦å®Œæˆï¼Œæ— è®ºç³»ç»Ÿå‘ç”Ÿä»€ä¹ˆé”™è¯¯ï¼Œç»“æœéƒ½ä¸ä¼šå—åˆ°å½±å“ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œäº‹åŠ¡çš„ç»“æœè¢«å†™åˆ°æŒä¹…åŒ–å­˜å‚¨å™¨ä¸­

# 12.2ã€æµ‹è¯•

å°†ä¸Šé¢çš„ä»£ç æ‹·è´åˆ°ä¸€ä¸ªæ–°é¡¹ç›®ä¸­

åœ¨ä¹‹å‰çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ç»™userDaoæ¥å£æ–°å¢ä¸¤ä¸ªæ–¹æ³•ï¼Œåˆ é™¤å’Œå¢åŠ ç”¨æˆ·ï¼›

```javascript
1 //æ·»åŠ ä¸€ä¸ªç”¨æˆ·  
2 int addUser(User user);  
3  
4 //æ ¹æ®idåˆ é™¤ç”¨æˆ·  
5 int deleteUser(int id);
```

mapperæ–‡ä»¶ï¼Œæˆ‘ä»¬æ•…æ„æŠŠ deletes å†™é”™ï¼Œæµ‹è¯•ï¼

```txt
1 <insert id="addUser" parameterType  $=$  "com.kuang.pojo.User">   
2 insert into user (id,name,pwd) values (#{id},#,name},#,{pwd})   
3 </insert>   
4   
5 <delete id  $=$  "deleteUser" parameterType  $=$  "int">   
6 deletes from user where id  $=$  #{id}   
7 </delete>
```

ç¼–å†™æ¥å£çš„å®ç°ç±»ï¼Œåœ¨å®ç°ç±»ä¸­ï¼Œæˆ‘ä»¬å»æ“ä½œä¸€æ³¢

```java
public class UserDaoImpl extends DaoSupport implements Mapper {
    //å¢åŠ ä¸€äº›æ“ä½œ
    public List selectUser() {
        User user = new User(4, "å°æ˜", "123456");
        Mapper mapper = getSession().getMapper(UserMapper.class);
        mapper.addUser(user);
        mapper.deleteuser(4);
        return mapper.selectUser();
    }
}
```

æµ‹è¯•

```java
1 @Test   
2 public void test2(){   
3 ApplicationContext context  $=$  new   
ClassPathXmlApplicationContext("beans.xml");   
4 UserMapper mapper  $=$  (UserMapper) context.getBean("userDao");   
5 List<User> user  $=$  mapper.selectUser();   
6 System.out.println(user);   
7 }
```

æŠ¥é”™ï¼šsqlå¼‚å¸¸ï¼Œdeleteå†™é”™äº†

ç»“æœï¼šæ’å…¥æˆåŠŸï¼

æ²¡æœ‰è¿›è¡Œäº‹åŠ¡çš„ç®¡ç†ï¼›æˆ‘ä»¬æƒ³è®©ä»–ä»¬éƒ½æˆåŠŸæ‰æˆåŠŸï¼Œæœ‰ä¸€ä¸ªå¤±è´¥ï¼Œå°±éƒ½å¤±è´¥ï¼Œæˆ‘ä»¬å°±åº”è¯¥éœ€è¦äº‹åŠ¡ï¼

ä»¥å‰æˆ‘ä»¬éƒ½éœ€è¦è‡ªå·±æ‰‹åŠ¨ç®¡ç†äº‹åŠ¡ï¼Œååˆ†éº»çƒ¦ï¼

ä½†æ˜¯Springç»™æˆ‘ä»¬æä¾›äº†äº‹åŠ¡ç®¡ç†ï¼Œæˆ‘ä»¬åªéœ€è¦é…ç½®å³å¯ï¼›

# 12.3ã€Springä¸­çš„äº‹åŠ¡ç®¡ç†

Springåœ¨ä¸åŒçš„äº‹åŠ¡ç®¡ç†APIä¹‹ä¸Šå®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä½¿å¾—å¼€å‘äººå‘˜ä¸å¿…äº†è§£åº•å±‚çš„äº‹åŠ¡ç®¡ç†APIå°±å¯ä»¥ä½¿ç”¨Springçš„äº‹åŠ¡ç®¡ç†æœºåˆ¶ã€‚Springæ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†å’Œå£°æ˜å¼çš„äº‹åŠ¡ç®¡ç†ã€‚

# ç¼–ç¨‹å¼äº‹åŠ¡ç®¡ç†

- å°†äº‹åŠ¡ç®¡ç†ä»£ç åµŒåˆ°ä¸šåŠ¡æ–¹æ³•ä¸­æ¥æ§åˆ¶äº‹åŠ¡çš„æäº¤å’Œå›æ»š
- ç¼ºç‚¹ï¼šå¿…é¡»åœ¨æ¯ä¸ªäº‹åŠ¡æ“ä½œä¸šåŠ¡é€»è¾‘ä¸­åŒ…å«é¢å¤–çš„äº‹åŠ¡ç®¡ç†ä»£ç 

# å£°æ˜å¼äº‹åŠ¡ç®¡ç†

ä¸€èˆ¬æƒ…å†µä¸‹æ¯”ç¼–ç¨‹å¼äº‹åŠ¡å¥½ç”¨ã€‚

- å°†äº‹åŠ¡ç®¡ç†ä»£ç ä»ä¸šåŠ¡æ–¹æ³•ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»¥å£°æ˜çš„æ–¹å¼æ¥å®ç°äº‹åŠ¡ç®¡ç†ã€‚
- å°†äº‹åŠ¡ç®¡ç†ä½œä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œé€šè¿‡aopæ–¹æ³•æ¨¡å—åŒ–ã€‚Springä¸­é€šè¿‡Spring AOPæ¡†æ¶æ”¯æŒå£°æ˜å¼äº‹åŠ¡ç®¡ç†ã€‚

# ä½¿ç”¨Springç®¡ç†äº‹åŠ¡ï¼Œæ³¨æ„å¤´æ–‡ä»¶çš„çº¦æŸå¯¼å…¥ï¼štx

```txt
1 xmlns:tx="http://www.springframework.org/schema/tx"   
2   
3 http://www.springframework.org/schema/tx   
4 http://www.springframework.org/schema/tx/spring-tx.xsd">
```

# äº‹åŠ¡ç®¡ç†å™¨

- æ— è®ºä½¿ç”¨Springçš„å“ªç§äº‹åŠ¡ç®¡ç†ç­–ç•¥ï¼ˆç¼–ç¨‹å¼æˆ–è€…å£°æ˜å¼ï¼‰äº‹åŠ¡ç®¡ç†å™¨éƒ½æ˜¯å¿…é¡»çš„ã€‚
- å°±æ˜¯ Springçš„æ ¸å¿ƒäº‹åŠ¡ç®¡ç†æŠ½è±¡ï¼Œç®¡ç†å°è£…äº†ä¸€ç»„ç‹¬ç«‹äºæŠ€æœ¯çš„æ–¹æ³•ã€‚

# JDBCäº‹åŠ¡

```html
<bean id="transactionManager" class="org.springframework{jdbc.DataSource.DataSourceTransactionManager">
    <property name="DataSource" ref=".DataSource" />
</bean>
```

# é…ç½®å¥½äº‹åŠ¡ç®¡ç†å™¨åæˆ‘ä»¬éœ€è¦å»é…ç½®äº‹åŠ¡çš„é€šçŸ¥

```xml
1 <--é…ç½®äº‹åŠ¡é€šçŸ¥-->
2 <tx:advice id="txAdvice" transaction-manager="transactionManager">
3 <tx:attributes>
4 <--é…ç½®å“ªäº›æ–¹æ³•ä½¿ç”¨ä»€ä¹ˆæ ·çš„äº‹åŠ¡ï¼Œé…ç½®äº‹åŠ¡çš„ä¼ æ’­ç‰¹æ€§-->
5 <tx:method name="add" propagation="REQUIRED"/> 
6 <tx:method name="delete" propagation="REQUIRED"/> 
7 <tx:method name="update" propagation="REQUIRED"/> 
8 <tx:method name="search*" propagation="REQUIRED"/> 
9 <tx:method name="get" read-only="true"/> 
10 <tx:method name=*" propagation="REQUIRED"/> 
11 </tx:attributes>
12 </tx:advice>
```

# springäº‹åŠ¡ä¼ æ’­ç‰¹æ€§ï¼š

äº‹åŠ¡ä¼ æ’­è¡Œä¸ºå°±æ˜¯å¤šä¸ªäº‹åŠ¡æ–¹æ³•ç›¸äº’è°ƒç”¨æ—¶ï¼Œäº‹åŠ¡å¦‚ä½•åœ¨è¿™äº›æ–¹æ³•é—´ä¼ æ’­ã€‚springæ”¯æŒ7ç§äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼š

- propagationrequiredï¼šå¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œå°±æ–°å»ºä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœå·²å­˜åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒåŠ å…¥åˆ°è¿™ä¸ªäº‹åŠ¡ä¸­ï¼Œè¿™æ˜¯æœ€å¸¸è§çš„é€‰æ‹©ã€‚
- propagation_supports: æ”¯æŒå½“å‰äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å½“å‰äº‹åŠ¡ï¼Œå°±ä»¥éäº‹åŠ¡æ–¹æ³•æ‰§è¡Œã€‚
- propagation_mandatory: ä½¿ç”¨å½“å‰äº‹åŠ¡ï¼Œå¦‚æœæ²¡æœ‰å½“å‰äº‹åŠ¡ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ã€‚
- propagation_required_new: æ–°å»ºäº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼ŒæŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚
- propagation_notSupportedï¼šä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œå°±æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‚
- propagation Never: ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚
- propagation_nestedï¼šå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡å†…æ‰§è¡Œã€‚å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æ‰§è¡Œä¸propagation_requiredç±»ä¼¼çš„æ“ä½œ

Spring é»˜è®¤çš„äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAGATION_REQUIREDï¼Œå®ƒé€‚åˆäºç»å¤§å¤šæ•°çš„æƒ…å†µã€‚

å‡è®¾ ServiveX#methodX() éƒ½å·¥ä½œåœ¨äº‹åŠ¡ç¯å¢ƒä¸‹ï¼ˆå³éƒ½è¢« Spring äº‹åŠ¡å¢å¼ºäº†ï¼‰ï¼Œå‡è®¾ç¨‹åºä¸­å­˜åœ¨å¦‚ä¸‹çš„è°ƒç”¨é“¾ï¼šService1#method1()->
Service2#method2->Service3#method3()ï¼Œé‚£ä¹ˆè¿™ 3 ä¸ªæœåŠ¡ç±»çš„ 3 ä¸ªæ–¹æ³•é€šè¿‡ Spring çš„äº‹åŠ¡ä¼ æ’­æœºåˆ¶éƒ½å·¥ä½œåœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­ã€‚

å°±å¥½æ¯”ï¼Œæˆ‘ä»¬åˆšæ‰çš„å‡ ä¸ªæ–¹æ³•å­˜åœ¨è°ƒç”¨ï¼Œæ‰€ä»¥ä¼šè¢«æ”¾åœ¨ä¸€ç»„äº‹åŠ¡å½“ä¸­ï¼

# é…ç½®AOP

å¯¼å…¥aopçš„å¤´æ–‡ä»¶ï¼

```txt
1 <--é…ç½®aopç»‡å…¥äº‹åŠ¡-->   
2 <aop:config>   
3 <aop:pointcut id="txPointcut" expression="execution(\* com.kuang.dao.*.\* (.))"/>   
4 <aop:advisor advice-ref="txAdvice" pointcut-ref="txPointcut"/>   
5 </aop:config>
```

# è¿›è¡Œæµ‹è¯•

åˆ æ‰åˆšæ‰æ’å…¥çš„æ•°æ®ï¼Œå†æ¬¡æµ‹è¯•ï¼

```java
1 @Test   
2 public void test2(){   
3 ApplicationContext context  $=$  new   
ClassPathXmlApplicationContext("beans.xml");   
4 UserMapper mapper  $=$  (UserMapper) context.getBean("userDao");   
5 List<User> user  $=$  mapper.selectUser();   
6 System.out.println(user);   
7 }
```

# æ€è€ƒé—®é¢˜ï¼Ÿ

ä¸ºä»€ä¹ˆéœ€è¦é…ç½®äº‹åŠ¡ï¼Ÿ

- å¦‚æœä¸é…ç½®ï¼Œå°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨æäº¤æ§åˆ¶äº‹åŠ¡ï¼›
- äº‹åŠ¡åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹éå¸¸é‡è¦ï¼Œæ¶‰åŠåˆ°æ•°æ®çš„ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œä¸å®¹é©¬è™ï¼